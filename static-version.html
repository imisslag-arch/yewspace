<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∑ Áõ∏Êú∫ÁßüËµÅÁÆ°ÁêÜÁ≥ªÁªü - ÁßªÂä®Áâà</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: #2E64E5;
            border-radius: 8px;
            position: relative;
            animation: pulse 2s infinite;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            width: 20px;
            height: 20px;
            background: #2E64E5;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border: 3px solid white;
            border-radius: 50%;
            background: white;
        }

        .logo-icon .inner-circle {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #2E64E5;
            border-radius: 50%;
            border: 2px solid white;
        }

        .logo-icon .vertical-line {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 2px;
            height: 20px;
            background: white;
        }

        .logo-icon .text {
            position: absolute;
            top: 50%;
            left: 8px;
            transform: translateY(-50%);
            color: white;
            font-size: 8px;
            font-weight: bold;
            line-height: 1;
            text-align: center;
        }

        .logo-text h1 {
            margin: 0 0 5px 0;
            font-size: 2.2em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .logo-text p {
            margin: 0;
            font-size: 1em;
            opacity: 0.9;
            font-weight: 300;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .page {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: 70vh;
        }

        .page.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
        }

        .calendar-nav:hover {
            background: #5a6fd8;
        }

        .month-year {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: #666;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            position: relative;
        }

        .day:hover {
            background: #e3f2fd;
            transform: scale(1.05);
        }

        .day.selected {
            background: #667eea;
            color: white;
        }

        .day.today {
            background: #ffeb3b;
            color: #333;
        }

        .day.other-month {
            color: #ccc;
        }

        .day.has-order {
            background: #4caf50;
            color: white;
        }

        .day.has-order::after {
            content: '‚óè';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .booking-lines {
            display: flex;
            flex-direction: column;
            gap: 1px;
            max-height: 20px;
            overflow: hidden;
        }

        .booking-line {
            width: 100%;
            height: 3px;
            border-radius: 1px;
            transition: opacity 0.2s;
        }

        .booking-line:hover {
            opacity: 0.8;
        }

        .rental-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .task-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-time {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .task-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .task-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .task-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .task-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
        }

        .task-detail {
            display: flex;
            flex-direction: column;
        }

        .task-detail strong {
            color: #495057;
            margin-bottom: 2px;
        }

        .task-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }

        .btn-task {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .btn-complete {
            background: #28a745;
            color: white;
        }

        .btn-complete:hover {
            background: #218838;
        }

        .btn-call {
            background: #17a2b8;
            color: white;
        }

        .btn-call:hover {
            background: #138496;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .orders-table th,
        .orders-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .orders-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #555;
        }

        .orders-table tr:hover {
            background: #f5f5f5;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d4edda; color: #155724; }
        .status-picked_up { background: #cce5ff; color: #004085; }
        .status-returned { background: #d1ecf1; color: #0c5460; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        .no-tasks {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .logo {
                flex-direction: column;
                gap: 10px;
            }
            
            .logo-icon {
                width: 50px;
                height: 50px;
            }
            
            .logo-icon .text {
                font-size: 7px;
            }
            
            .logo-text h1 {
                font-size: 1.8em;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-tab {
                width: 100%;
                max-width: 300px;
            }
            
            .rental-info {
                grid-template-columns: 1fr;
            }
            
            .summary-stats {
                grid-template-columns: 1fr;
            }
            
            .task-details {
                grid-template-columns: 1fr;
            }
            
            .orders-table {
                font-size: 0.8em;
            }
            
            .orders-table th,
            .orders-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <div class="text">YEW'S<br>SPACE</div>
                        <div class="vertical-line"></div>
                        <div class="inner-circle"></div>
                    </div>
                    <div class="logo-text">
                        <h1>YEW'S SPACE</h1>
                        <p>‰∏ì‰∏öÁõ∏Êú∫ÁßüËµÅÁÆ°ÁêÜ</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('booking')">È¢ÑËÆ¢Á≥ªÁªü</button>
            <button class="nav-tab" onclick="showPage('daily-tasks')">ÊØèÊó•‰ªªÂä°</button>
            <button class="nav-tab" onclick="showPage('orders')">ËÆ¢ÂçïÁÆ°ÁêÜ</button>
            <button class="nav-tab" onclick="showPage('cameras')">Áõ∏Êú∫ÁÆ°ÁêÜ</button>
            <button class="nav-tab" id="edit-order-tab" onclick="showPage('edit-order')" style="display: none;">ÁºñËæëËÆ¢Âçï</button>
        </div>

        <!-- È¢ÑËÆ¢È°µÈù¢ -->
        <div id="booking-page" class="page active">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="previousMonth()">‚Äπ</button>
                    <div class="month-year" id="month-year"></div>
                    <button class="calendar-nav" onclick="nextMonth()">‚Ä∫</button>
                </div>
                <div class="weekdays">
                    <div class="weekday">Âë®‰∏Ä</div>
                    <div class="weekday">Âë®‰∫å</div>
                    <div class="weekday">Âë®‰∏â</div>
                    <div class="weekday">Âë®Âõõ</div>
                    <div class="weekday">Âë®‰∫î</div>
                    <div class="weekday">Âë®ÂÖ≠</div>
                    <div class="weekday">Âë®Êó•</div>
                </div>
                <div class="days" id="calendar-days"></div>
            </div>

            <form id="booking-form">
                <div class="rental-info">
                    <div>
                        <h3>ÂÆ¢Êà∑‰ø°ÊÅØ</h3>
                        <div class="form-group">
                            <label>ÂÆ¢Êà∑ÂßìÂêç</label>
                            <input type="text" id="customer-name" placeholder="ËæìÂÖ•ÂÆ¢Êà∑ÂßìÂêç" required>
                        </div>
                        <div class="form-group">
                            <label>ÂÆ¢Êà∑ÁîµËØù</label>
                            <input type="tel" id="customer-phone" placeholder="ËæìÂÖ•ÂÆ¢Êà∑ÁîµËØù" required>
                        </div>
                        <div class="form-group">
                            <label>ÂèñÊú∫Âú∞ÁÇπ</label>
                            <select id="pickup-location" onchange="toggleCustomAddress()">
                                <option value="KL">ÂêâÈöÜÂù° (KL)</option>
                                <option value="JB">Êñ∞Â±± (JB)</option>
                                <option value="custom">Ëá™Âèñ - Ëá™ÂÆö‰πâÂú∞ÂùÄ</option>
                            </select>
                        </div>
                        <div class="form-group" id="custom-address-group" style="display: none;">
                            <label>Ëá™ÂèñÂú∞ÂùÄ</label>
                            <textarea id="custom-address" placeholder="ËØ∑ËæìÂÖ•ËØ¶ÁªÜÂú∞ÂùÄ"></textarea>
                        </div>
                    </div>
                    
                    <div>
                        <h3>Áõ∏Êú∫ÈÄâÊã©</h3>
                        <div class="form-group">
                            <label>ÈÄâÊã©Áõ∏Êú∫</label>
                            <select id="camera-select" onchange="onCameraSelect()">
                                <option value="">ËØ∑ÈÄâÊã©Áõ∏Êú∫</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Áõ∏Êú∫ÂûãÂè∑</label>
                            <input type="text" id="camera-model" placeholder="ÊâãÂä®ËæìÂÖ•Áõ∏Êú∫ÂûãÂè∑" readonly>
                        </div>
                        <div class="form-group">
                            <label>ÂìÅÁâå</label>
                            <input type="text" id="camera-brand" placeholder="ÊâãÂä®ËæìÂÖ•ÂìÅÁâå" readonly>
                        </div>
                    </div>
                    
                    <div>
                        <h3>ÁßüËµÅ‰ø°ÊÅØ</h3>
                        <div class="form-group">
                            <label>ÂèñÊú∫Êó•Êúü</label>
                            <input type="date" id="pickup-date" required>
                        </div>
                        <div class="form-group">
                            <label>ËøòÊú∫Êó•Êúü</label>
                            <input type="date" id="return-date" required>
                        </div>
                        <div class="form-group">
                            <label>ÂèñÊú∫Êó∂Èó¥</label>
                            <input type="time" id="pickup-time" value="10:00">
                        </div>
                        <div class="form-group">
                            <label>ËøòÊú∫Êó∂Èó¥</label>
                            <input type="time" id="return-time" value="18:00">
                        </div>
                        <div class="form-group">
                            <label>Êó•ÁßüÈáë (RM)</label>
                            <input type="number" id="daily-rate" placeholder="ËæìÂÖ•Êó•ÁßüÈáë" required>
                        </div>
                        <div class="form-group">
                            <label>ÊäºÈáë (RM)</label>
                            <input type="number" id="deposit" placeholder="ËæìÂÖ•ÊäºÈáë" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="insurance-checkbox" onchange="toggleInsurance()">
                                Ë¥≠‰π∞‰øùÈô© (RM5/Â§©)
                            </label>
                            <input type="number" id="insurance-fee" value="0" readonly>
                        </div>
                    </div>
                </div>

                <!-- ‰ª∑Ê†ºËÆ°ÁÆóÊòæÁ§∫ -->
                <div class="summary-card" style="margin-top: 20px;">
                    <h3>Ë¥πÁî®ËÆ°ÁÆó</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="rental-days">0</span>
                            <span class="stat-label">ÁßüËµÅÂ§©Êï∞</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="rent-total">RM 0.00</span>
                            <span class="stat-label">ÁßüÈáëÂ∞èËÆ°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="total-amount">RM 0.00</span>
                            <span class="stat-label">ÊÄªËÆ°ÈáëÈ¢ù</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                        <div>ÊäºÈáë: <span id="deposit-display">RM 0.00</span></div>
                        <div>‰øùÈô©: <span id="insurance-fee-display">RM 0.00</span></div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button type="button" class="btn" onclick="forceCalculate()" style="width: auto; background: #28a745;">ÈáçÊñ∞ËÆ°ÁÆó</button>
                    </div>
                </div>

                <button type="button" class="btn" onclick="createOrder()">ÂàõÂª∫ËÆ¢Âçï</button>
            </form>
        </div>

        <!-- ÊØèÊó•‰ªªÂä°È°µÈù¢ -->
        <div id="daily-tasks-page" class="page">
            <div class="summary-card">
                <h3>‰ªäÊó•Ê¶ÇËßà</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="today-pickups">0</span>
                        <span class="stat-label">ÂèñÊú∫‰ªªÂä°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="today-returns">0</span>
                        <span class="stat-label">ÂΩíËøò‰ªªÂä°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="today-total">0</span>
                        <span class="stat-label">ÊÄª‰ªªÂä°Êï∞</span>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                <div>
                    <h3><i class="fas fa-arrow-up" style="color: #28a745;"></i> ‰ªäÊó•ÂèñÊú∫‰ªªÂä°</h3>
                    <div id="pickup-tasks" class="task-list">
                        <div class="no-tasks">‰ªäÊó•Êó†ÂèñÊú∫‰ªªÂä°</div>
                    </div>
                </div>

                <div>
                    <h3><i class="fas fa-arrow-down" style="color: #ffc107;"></i> ‰ªäÊó•ÂΩíËøò‰ªªÂä°</h3>
                    <div id="return-tasks" class="task-list">
                        <div class="no-tasks">‰ªäÊó•Êó†ÂΩíËøò‰ªªÂä°</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3><i class="fas fa-calendar-week" style="color: #007bff;"></i> Êú™Êù•7Â§©‰ªªÂä°È¢ÑËßà</h3>
                <div id="upcoming-tasks" class="upcoming-list">
                    <div class="no-tasks">Êú™Êù•7Â§©Êó†‰ªªÂä°</div>
                </div>
            </div>
        </div>

        <!-- ËÆ¢ÂçïÁÆ°ÁêÜÈ°µÈù¢ -->
        <div id="orders-page" class="page">
            <h2>ÊâÄÊúâËÆ¢Âçï</h2>
            <div id="orders-loading" class="loading">Âä†ËΩΩ‰∏≠...</div>
            <table class="orders-table" id="orders-table" style="display: none;">
                <thead>
                    <tr>
                        <th>ËÆ¢ÂçïÂè∑</th>
                        <th>ÂÆ¢Êà∑ÂßìÂêç</th>
                        <th>Áõ∏Êú∫ÂûãÂè∑</th>
                        <th>ÂèñÊú∫Êó•Êúü</th>
                        <th>ËøòÊú∫Êó•Êúü</th>
                        <th>Âú∞ÁÇπ</th>
                        <th>ÊäºÈáë</th>
                        <th>Áä∂ÊÄÅ</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody id="orders-tbody">
                </tbody>
            </table>
        </div>

        <!-- ËÆ¢ÂçïÁºñËæëÈ°µÈù¢ -->
        <div id="edit-order-page" class="page">
            <div class="page-header">
                <h2>ÁºñËæëËÆ¢Âçï</h2>
                <button class="btn" onclick="showPage('orders')" style="width: auto; background: #6c757d;">ËøîÂõûËÆ¢ÂçïÁÆ°ÁêÜ</button>
            </div>
            
            <form id="edit-order-form">
                <div class="rental-info">
                    <div>
                        <h3>ÂÆ¢Êà∑‰ø°ÊÅØ</h3>
                        <div class="form-group">
                            <label>ÂÆ¢Êà∑ÂßìÂêç</label>
                            <input type="text" id="edit-customer-name" placeholder="ËæìÂÖ•ÂÆ¢Êà∑ÂßìÂêç" required>
                        </div>
                        <div class="form-group">
                            <label>ÂÆ¢Êà∑ÁîµËØù</label>
                            <input type="tel" id="edit-customer-phone" placeholder="ËæìÂÖ•ÂÆ¢Êà∑ÁîµËØù" required>
                        </div>
                        <div class="form-group">
                            <label>ÂèñÊú∫Âú∞ÁÇπ</label>
                            <select id="edit-pickup-location" onchange="toggleEditCustomAddress()">
                                <option value="KL">ÂêâÈöÜÂù° (KL)</option>
                                <option value="JB">Êñ∞Â±± (JB)</option>
                                <option value="custom">Ëá™Âèñ - Ëá™ÂÆö‰πâÂú∞ÂùÄ</option>
                            </select>
                        </div>
                        <div class="form-group" id="edit-custom-address-group" style="display: none;">
                            <label>Ëá™ÂèñÂú∞ÂùÄ</label>
                            <textarea id="edit-custom-address" placeholder="ËØ∑ËæìÂÖ•ËØ¶ÁªÜÂú∞ÂùÄ"></textarea>
                        </div>
                    </div>
                    
                    <div>
                        <h3>Áõ∏Êú∫ÈÄâÊã©</h3>
                        <div class="form-group">
                            <label>ÈÄâÊã©Áõ∏Êú∫</label>
                            <select id="edit-camera-select" onchange="onEditCameraSelect()">
                                <option value="">ËØ∑ÈÄâÊã©Áõ∏Êú∫</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Áõ∏Êú∫ÂûãÂè∑</label>
                            <input type="text" id="edit-camera-model" placeholder="ÊâãÂä®ËæìÂÖ•Áõ∏Êú∫ÂûãÂè∑">
                        </div>
                        <div class="form-group">
                            <label>ÂìÅÁâå</label>
                            <input type="text" id="edit-camera-brand" placeholder="ÊâãÂä®ËæìÂÖ•ÂìÅÁâå">
                        </div>
                    </div>
                    
                    <div>
                        <h3>ÁßüËµÅ‰ø°ÊÅØ</h3>
                        <div class="form-group">
                            <label>ÂèñÊú∫Êó•Êúü</label>
                            <input type="date" id="edit-pickup-date" required>
                        </div>
                        <div class="form-group">
                            <label>ËøòÊú∫Êó•Êúü</label>
                            <input type="date" id="edit-return-date" required>
                        </div>
                        <div class="form-group">
                            <label>ÂèñÊú∫Êó∂Èó¥</label>
                            <input type="time" id="edit-pickup-time" value="10:00">
                        </div>
                        <div class="form-group">
                            <label>ËøòÊú∫Êó∂Èó¥</label>
                            <input type="time" id="edit-return-time" value="18:00">
                        </div>
                        <div class="form-group">
                            <label>Êó•ÁßüÈáë (RM)</label>
                            <input type="number" id="edit-daily-rate" placeholder="ËæìÂÖ•Êó•ÁßüÈáë" required>
                        </div>
                        <div class="form-group">
                            <label>ÊäºÈáë (RM)</label>
                            <input type="number" id="edit-deposit" placeholder="ËæìÂÖ•ÊäºÈáë" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="edit-insurance-checkbox" onchange="toggleEditInsurance()">
                                Ë¥≠‰π∞‰øùÈô© (RM5/Â§©)
                            </label>
                            <input type="number" id="edit-insurance-fee" value="0" readonly>
                        </div>
                    </div>
                </div>

                <!-- ‰ª∑Ê†ºËÆ°ÁÆóÊòæÁ§∫ -->
                <div class="summary-card" style="margin-top: 20px;">
                    <h3>Ë¥πÁî®ËÆ°ÁÆó</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="edit-rental-days">0</span>
                            <span class="stat-label">ÁßüËµÅÂ§©Êï∞</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="edit-rent-total">RM 0.00</span>
                            <span class="stat-label">ÁßüÈáëÂ∞èËÆ°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="edit-total-amount">RM 0.00</span>
                            <span class="stat-label">ÊÄªËÆ°ÈáëÈ¢ù</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                        <div>ÊäºÈáë: <span id="edit-deposit-display">RM 0.00</span></div>
                        <div>‰øùÈô©: <span id="edit-insurance-fee-display">RM 0.00</span></div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="saveOrderEdit()" style="flex: 1;">‰øùÂ≠ò‰øÆÊîπ</button>
                    <button type="button" class="btn" onclick="cancelOrderEdit()" style="flex: 1; background: #6c757d;">ÂèñÊ∂à</button>
                    <button type="button" class="btn" onclick="deleteOrder()" style="flex: 1; background: #dc3545;">Âà†Èô§ËÆ¢Âçï</button>
                </div>
            </form>
        </div>

        <!-- Áõ∏Êú∫ÁÆ°ÁêÜÈ°µÈù¢ -->
        <div id="cameras-page" class="page">
            <h2>Áõ∏Êú∫ÁÆ°ÁêÜ</h2>
            <button class="btn" onclick="showAddCameraForm()" style="width: auto; margin-bottom: 20px;">Ê∑ªÂä†Áõ∏Êú∫</button>
            
            <div id="add-camera-form" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3>Ê∑ªÂä†Êñ∞Áõ∏Êú∫</h3>
                <div class="form-group">
                    <label>Áõ∏Êú∫ÂûãÂè∑</label>
                    <input type="text" id="camera-model" placeholder="ËæìÂÖ•Áõ∏Êú∫ÂûãÂè∑">
                </div>
                <div class="form-group">
                    <label>ÂìÅÁâå</label>
                    <input type="text" id="camera-brand" placeholder="ËæìÂÖ•ÂìÅÁâå">
                </div>
                <div class="form-group">
                    <label>Êó•ÁßüÈáë (RM)</label>
                    <input type="number" id="camera-daily-rate" placeholder="ËæìÂÖ•Êó•ÁßüÈáë">
                </div>
                <div class="form-group">
                    <label>ÊäºÈáë (RM)</label>
                    <input type="number" id="camera-deposit" placeholder="ËæìÂÖ•ÊäºÈáë">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="addCamera()" style="width: auto;">Ê∑ªÂä†</button>
                    <button class="btn" onclick="hideAddCameraForm()" style="width: auto; background: #6c757d;">ÂèñÊ∂à</button>
                </div>
            </div>

            <div id="cameras-list">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentDate = new Date();
        let orders = JSON.parse(localStorage.getItem('cameraRentalOrders') || '[]');
        let cameras = JSON.parse(localStorage.getItem('cameraRentalCameras') || '[]');
        let orderCounter = parseInt(localStorage.getItem('cameraRentalOrderCounter') || '1000');

        // Â¶ÇÊûúÊ≤°ÊúâÁõ∏Êú∫Êï∞ÊçÆÔºåÂàùÂßãÂåñÈªòËÆ§Áõ∏Êú∫
        if (cameras.length === 0) {
            cameras = [
                { id: 1, brand: 'DJI', model: 'Air 2S', dailyRate: 80, deposit: 300, status: 'available', color: '#3498db' },
                { id: 2, brand: 'DJI', model: 'Mini 3 Pro', dailyRate: 60, deposit: 250, status: 'available', color: '#e74c3c' },
                { id: 3, brand: 'DJI', model: 'Mavic 3', dailyRate: 100, deposit: 400, status: 'available', color: '#2ecc71' },
                { id: 4, brand: 'Canon', model: 'EOS R5', dailyRate: 150, deposit: 500, status: 'maintenance', color: '#f39c12' },
                { id: 5, brand: 'Sony', model: 'A7R IV', dailyRate: 120, deposit: 400, status: 'available', color: '#9b59b6' }
            ];
            saveData();
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
            loadDailyTasks();
            loadOrders();
            loadCameras();
            loadCameraSelect();
            setupDefaultDates();
            
            // ÂàùÂßãÂåñËÆ°ÁÆó
            setTimeout(() => {
                calculateTotal();
            }, 500);
        });

        // Êó•ÂéÜÂäüËÉΩ
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ['‰∏ÄÊúà', '‰∫åÊúà', '‰∏âÊúà', 'ÂõõÊúà', '‰∫îÊúà', 'ÂÖ≠Êúà', '‰∏ÉÊúà', 'ÂÖ´Êúà', '‰πùÊúà', 'ÂçÅÊúà', 'ÂçÅ‰∏ÄÊúà', 'ÂçÅ‰∫åÊúà'];
            
            document.getElementById('month-year').textContent = `${year}Âπ¥ ${monthNames[month]}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayOfWeek = (firstDay.getDay() + 6) % 7; // Âë®‰∏Ä‰∏∫0
            
            const daysContainer = document.getElementById('calendar-days');
            daysContainer.innerHTML = '';
            
            // ‰∏ä‰∏™ÊúàÁöÑÊó•Êúü
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = new Date(year, month, -i);
                const dayElement = createDayElement(day, true);
                daysContainer.appendChild(dayElement);
            }
            
            // ÂΩìÂâçÊúàÁöÑÊó•Êúü
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                const dayElement = createDayElement(date, false);
                daysContainer.appendChild(dayElement);
            }
            
            // ‰∏ã‰∏™ÊúàÁöÑÊó•Êúü
            const remainingDays = 42 - (firstDayOfWeek + lastDay.getDate());
            for (let day = 1; day <= remainingDays; day++) {
                const date = new Date(year, month + 1, day);
                const dayElement = createDayElement(date, true);
                daysContainer.appendChild(dayElement);
            }
        }

        function createDayElement(date, isOtherMonth) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day';
            dayElement.textContent = date.getDate();
            
            if (isOtherMonth) {
                dayElement.classList.add('other-month');
            }
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('today');
            }
            
            // Ê£ÄÊü•ËØ•Êó•ÊúüÁöÑÁõ∏Êú∫È¢ÑËÆ¢ÊÉÖÂÜµ
            const dateStr = date.toISOString().split('T')[0];
            const dayBookings = getDayBookings(dateStr);
            
            if (dayBookings.length > 0) {
                // ÂàõÂª∫Áõ∏Êú∫Ê°£ÊúüÁ∫øÊù°ÊòæÁ§∫
                const bookingLines = dayBookings.map(booking => 
                    `<div class="booking-line" style="background: ${booking.color}; height: 3px; margin: 1px 0; border-radius: 1px;" title="${booking.cameraName}"></div>`
                ).join('');
                
                dayElement.innerHTML = `
                    <div class="day-number">${date.getDate()}</div>
                    <div class="booking-lines">${bookingLines}</div>
                `;
            }
            
            dayElement.onclick = () => selectDate(date);
            
            return dayElement;
        }

        function getDayBookings(dateStr) {
            const bookings = [];
            
            orders.forEach(order => {
                if (!['pending', 'confirmed', 'picked_up'].includes(order.status)) {
                    return; // Ë∑≥ËøáÂ∑≤ÂèñÊ∂àÁöÑËÆ¢Âçï
                }
                
                const pickupDate = new Date(order.pickupDate + 'T00:00:00');
                const returnDate = new Date(order.returnDate + 'T00:00:00');
                const checkDate = new Date(dateStr + 'T00:00:00');
                
                // Ê£ÄÊü•Êó•ÊúüÊòØÂê¶Âú®ÁßüÊúüÂÜÖ
                if (checkDate >= pickupDate && checkDate <= returnDate) {
                    const camera = cameras.find(c => c.id == order.cameraId);
                    if (camera) {
                        bookings.push({
                            cameraName: `${camera.brand} ${camera.model}`,
                            color: camera.color || '#3498db',
                            orderId: order.id
                        });
                    }
                }
            });
            
            return bookings;
        }

        function selectDate(date) {
            // Ê∏ÖÈô§‰πãÂâçÁöÑÈÄâÊã©
            document.querySelectorAll('.day.selected').forEach(day => {
                day.classList.remove('selected');
            });
            
            // ÈÄâÊã©ÂΩìÂâçÊó•Êúü
            event.target.classList.add('selected');
            
            // Ëá™Âä®Â°´ÂÖÖÊó•Êúü
            const dateStr = date.toISOString().split('T')[0];
            document.getElementById('pickup-date').value = dateStr;
            
            // Ëá™Âä®ËÆæÁΩÆËøòÊú∫Êó•Êúü‰∏∫3Â§©Âêé
            const returnDate = new Date(date);
            returnDate.setDate(date.getDate() + 3);
            document.getElementById('return-date').value = returnDate.toISOString().split('T')[0];
            
            // ÈáçÊñ∞Ê∏≤ÊüìÊó•ÂéÜ‰ª•ÊòæÁ§∫È´ò‰∫Æ
            renderCalendar();
            // ÈáçÊñ∞ÈÄâÊã©ÂΩìÂâçÊó•Êúü
            setTimeout(() => {
                const selectedDay = Array.from(document.querySelectorAll('.day')).find(day => 
                    day.textContent == date.getDate() && !day.classList.contains('other-month')
                );
                if (selectedDay) {
                    selectedDay.classList.add('selected');
                }
            }, 0);
            
            calculateTotal();
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        // Ë°®ÂçïÂäüËÉΩ
        function setupDefaultDates() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            document.getElementById('pickup-date').value = today.toISOString().split('T')[0];
            document.getElementById('return-date').value = tomorrow.toISOString().split('T')[0];
            
            // ËÆæÁΩÆÈªòËÆ§Êó∂Èó¥
            document.getElementById('pickup-time').value = '10:00';
            document.getElementById('return-time').value = '18:00';
        }

        function toggleCustomAddress() {
            const locationSelect = document.getElementById('pickup-location');
            const customAddressGroup = document.getElementById('custom-address-group');
            
            if (locationSelect.value === 'custom') {
                customAddressGroup.style.display = 'block';
            } else {
                customAddressGroup.style.display = 'none';
            }
        }

        function toggleInsurance() {
            const checkbox = document.getElementById('insurance-checkbox');
            const insuranceInput = document.getElementById('insurance-fee');
            const pickupDateStr = document.getElementById('pickup-date').value;
            const returnDateStr = document.getElementById('return-date').value;
            
            if (checkbox.checked && pickupDateStr && returnDateStr) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                insuranceInput.value = days * 5;
            } else {
                insuranceInput.value = 0;
            }
        }

        // Ê∑ªÂä† calculateInsurance ÂáΩÊï∞
        function calculateInsurance() {
            const checkbox = document.getElementById('insurance-checkbox');
            const insuranceInput = document.getElementById('insurance-fee');
            const pickupDateStr = document.getElementById('pickup-date').value;
            const returnDateStr = document.getElementById('return-date').value;
            
            if (checkbox.checked && pickupDateStr && returnDateStr) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                insuranceInput.value = days * 5;
            } else {
                insuranceInput.value = 0;
            }
        }

        function calculateTotal() {
            const pickupDateStr = document.getElementById('pickup-date').value;
            const returnDateStr = document.getElementById('return-date').value;
            const dailyRate = parseFloat(document.getElementById('daily-rate').value) || 0;
            const deposit = parseFloat(document.getElementById('deposit').value) || 0;
            
            console.log('ËÆ°ÁÆóÊÄª‰ª∑:', { pickupDateStr, returnDateStr, dailyRate, deposit });
            
            if (pickupDateStr && returnDateStr && dailyRate > 0) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                
                // Êõ¥Êñ∞‰øùÈô©ÈáëËÆ°ÁÆó
                calculateInsurance();
                const insuranceFee = parseFloat(document.getElementById('insurance-fee').value) || 0;
                
                const rentTotal = dailyRate * days;
                const totalAmount = rentTotal + deposit + insuranceFee;
                
                console.log('ËÆ°ÁÆóÁªìÊûú:', { days, rentTotal, deposit, insuranceFee, totalAmount });
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                document.getElementById('rental-days').textContent = days;
                document.getElementById('rent-total').textContent = `RM ${rentTotal.toFixed(2)}`;
                document.getElementById('total-amount').textContent = `RM ${totalAmount.toFixed(2)}`;
                document.getElementById('deposit-display').textContent = `RM ${deposit.toFixed(2)}`;
                document.getElementById('insurance-fee-display').textContent = `RM ${insuranceFee.toFixed(2)}`;
            } else {
                // Ê∏ÖÁ©∫ÊòæÁ§∫
                document.getElementById('rental-days').textContent = '0';
                document.getElementById('rent-total').textContent = 'RM 0.00';
                document.getElementById('total-amount').textContent = 'RM 0.00';
                document.getElementById('deposit-display').textContent = 'RM 0.00';
                document.getElementById('insurance-fee-display').textContent = 'RM 0.00';
            }
        }

        // Âº∫Âà∂ËÆ°ÁÆóÂáΩÊï∞
        function forceCalculate() {
            console.log('Âº∫Âà∂ËÆ°ÁÆóÊÄª‰ª∑');
            calculateTotal();
        }

        // Áõ∏Êú∫ÈÄâÊã©ÂäüËÉΩ
        function loadCameraSelect() {
            const select = document.getElementById('camera-select');
            select.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Áõ∏Êú∫</option>';
            
            cameras.forEach(camera => {
                const option = document.createElement('option');
                option.value = camera.id;
                option.textContent = `${camera.brand} ${camera.model} - RM${camera.dailyRate}/Â§©`;
                select.appendChild(option);
            });
        }

        function onCameraSelect() {
            const select = document.getElementById('camera-select');
            const selectedCameraId = select.value;
            
            console.log('ÈÄâÊã©Áõ∏Êú∫:', selectedCameraId);
            
            if (selectedCameraId) {
                const camera = cameras.find(c => c.id == selectedCameraId);
                if (camera) {
                    console.log('ÊâæÂà∞Áõ∏Êú∫:', camera);
                    document.getElementById('camera-model').value = camera.model;
                    document.getElementById('camera-brand').value = camera.brand;
                    document.getElementById('daily-rate').value = camera.dailyRate;
                    document.getElementById('deposit').value = camera.deposit;
                    
                    // Âº∫Âà∂ËÆ°ÁÆó
                    setTimeout(() => {
                        calculateTotal();
                    }, 100);
                }
            } else {
                // Ê∏ÖÁ©∫Â≠óÊÆµÔºåÂÖÅËÆ∏ÊâãÂä®ËæìÂÖ•
                document.getElementById('camera-model').value = '';
                document.getElementById('camera-brand').value = '';
                document.getElementById('daily-rate').value = '';
                document.getElementById('deposit').value = '';
                
                // Âº∫Âà∂ËÆ°ÁÆó
                setTimeout(() => {
                    calculateTotal();
                }, 100);
            }
        }

        // ËÆ¢ÂçïÁÆ°ÁêÜ
        function createOrder() {
            const customerName = document.getElementById('customer-name').value.trim();
            const customerPhone = document.getElementById('customer-phone').value.trim();
            const pickupDate = document.getElementById('pickup-date').value;
            const returnDate = document.getElementById('return-date').value;
            const pickupLocation = document.getElementById('pickup-location').value;
            const customAddress = document.getElementById('custom-address').value.trim();
            const cameraId = document.getElementById('camera-select').value;
            const cameraModel = document.getElementById('camera-model').value.trim();
            const cameraBrand = document.getElementById('camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('daily-rate').value);
            const deposit = parseFloat(document.getElementById('deposit').value);
            
            // È™åËØÅ
            if (!customerName || !customerPhone || !pickupDate || !returnDate || !dailyRate || !deposit) {
                alert('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ');
                return;
            }
            
            if (pickupLocation === 'custom' && !customAddress) {
                alert('ËØ∑Â°´ÂÜôËá™ÂèñÂú∞ÂùÄ');
                return;
            }
            
            const pickup = new Date(pickupDate);
            const returnD = new Date(returnDate);
            if (returnD <= pickup) {
                alert('ËøòÊú∫Êó•ÊúüÂøÖÈ°ªÊôö‰∫éÂèñÊú∫Êó•Êúü');
                return;
            }

            // Ê£ÄÊü•ÁßüÊúüÈáçÂè† - Âè™Ê£ÄÊü•Áõ∏ÂêåÁõ∏Êú∫ÁöÑÊúâÊïàËÆ¢Âçï
            const hasOverlap = orders.some(order => {
                // Âè™Ê£ÄÊü•Áõ∏ÂêåÁõ∏Êú∫ÁöÑËÆ¢Âçï
                if (order.cameraId !== cameraId) {
                    return false;
                }
                
                // Âè™Ê£ÄÊü•ÊúâÊïàËÆ¢ÂçïÔºàÊéíÈô§Â∑≤ÂèñÊ∂àÁöÑËÆ¢ÂçïÔºâ
                if (!['pending', 'confirmed', 'picked_up'].includes(order.status)) {
                    return false;
                }
                
                // ÊéíÈô§ÂΩìÂâçÁºñËæëÁöÑËÆ¢Âçï
                if (window.editingOrderId && order.id === window.editingOrderId) {
                    return false;
                }
                
                const existingPickup = new Date(order.pickupDate);
                const existingReturn = new Date(order.returnDate);
                return (pickup <= existingReturn && returnD >= existingPickup);
            });

            if (hasOverlap) {
                alert('‚ùå ÁßüÊúüÂÜ≤Á™ÅÔºÅËØ∑ÈÄâÊã©ÂÖ∂‰ªñÊó•Êúü„ÄÇ');
                return;
            }

            // ÊûÑÂª∫Âú∞ÁÇπ‰ø°ÊÅØ
            let locationInfo = '';
            if (pickupLocation === 'KL') {
                locationInfo = 'ÂêâÈöÜÂù° (KL)';
            } else if (pickupLocation === 'JB') {
                locationInfo = 'Êñ∞Â±± (JB)';
            } else if (pickupLocation === 'custom') {
                locationInfo = `Ëá™Âèñ - ${customAddress}`;
            }

            // ÂàõÂª∫ËÆ¢Âçï
            const order = {
                id: orderCounter++,
                orderNumber: `CR${orderCounter.toString().padStart(4, '0')}`,
                customerName: customerName,
                customerPhone: customerPhone,
                cameraId: cameraId || null,
                cameraModel: cameraModel || 'ÊâãÂä®ËÆ¢Âçï',
                cameraBrand: cameraBrand || 'ÊâãÂä®ËÆ¢Âçï',
                pickupDate: pickupDate,
                returnDate: returnDate,
                pickupTime: document.getElementById('pickup-time').value,
                returnTime: document.getElementById('return-time').value,
                pickupLocation: locationInfo,
                dailyRate: dailyRate,
                deposit: deposit,
                insuranceFee: parseFloat(document.getElementById('insurance-fee').value) || 0,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            if (window.editingOrderId) {
                // ÁºñËæëÊ®°ÂºèÔºöÊõ¥Êñ∞Áé∞ÊúâËÆ¢Âçï
                const orderIndex = orders.findIndex(o => o.id === window.editingOrderId);
                if (orderIndex !== -1) {
                    orders[orderIndex] = order;
                    alert(`ËÆ¢Âçï‰øÆÊîπÊàêÂäüÔºÅ\nËÆ¢ÂçïÂè∑: ${order.orderNumber}`);
                }
                window.editingOrderId = null;
            } else {
                // Êñ∞Âª∫Ê®°ÂºèÔºöÊ∑ªÂä†Êñ∞ËÆ¢Âçï
                orders.push(order);
                alert(`ËÆ¢ÂçïÂàõÂª∫ÊàêÂäüÔºÅ\nËÆ¢ÂçïÂè∑: ${order.orderNumber}`);
            }
            
            saveData();
            resetForm();
            loadDailyTasks();
            loadOrders();
        }

        function resetForm() {
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('pickup-location').value = 'KL';
            document.getElementById('custom-address').value = '';
            document.getElementById('custom-address-group').style.display = 'none';
            document.getElementById('camera-select').value = '';
            document.getElementById('camera-model').value = '';
            document.getElementById('camera-brand').value = '';
            document.getElementById('daily-rate').value = '';
            document.getElementById('deposit').value = '';
            document.getElementById('insurance-checkbox').checked = false;
            document.getElementById('insurance-fee').value = '0';
            setupDefaultDates();
            calculateTotal();
            
            // Ê∏ÖÈô§ÁºñËæëÊ®°Âºè
            window.editingOrderId = null;
        }

        // ÊØèÊó•‰ªªÂä°
        function loadDailyTasks() {
            const today = new Date().toISOString().split('T')[0];
            
            const pickupTasks = orders.filter(order => 
                order.pickupDate === today && ['pending', 'confirmed'].includes(order.status)
            );

            const returnTasks = orders.filter(order => 
                order.returnDate === today && ['confirmed', 'picked_up'].includes(order.status)
            );

            document.getElementById('today-pickups').textContent = pickupTasks.length;
            document.getElementById('today-returns').textContent = returnTasks.length;
            document.getElementById('today-total').textContent = pickupTasks.length + returnTasks.length;

            renderPickupTasks(pickupTasks);
            renderReturnTasks(returnTasks);
            renderUpcomingTasks(orders);
        }

        function renderPickupTasks(tasks) {
            const container = document.getElementById('pickup-tasks');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">‰ªäÊó•Êó†ÂèñÊú∫‰ªªÂä°</div>';
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-header">
                        <span class="task-time">${task.pickupTime || '10:00'}</span>
                        <span class="task-status pending">ÂæÖÂèñÊú∫</span>
                    </div>
                    <div class="task-details">
                        <div class="task-detail">
                            <strong>ËÆ¢ÂçïÂè∑:</strong> ${task.orderNumber}
                        </div>
                        <div class="task-detail">
                            <strong>ÂÆ¢Êà∑:</strong> ${task.customerName}
                        </div>
                        <div class="task-detail">
                            <strong>Áõ∏Êú∫:</strong> ${task.cameraModel || 'ÊâãÂä®ËÆ¢Âçï'}
                        </div>
                        <div class="task-detail">
                            <strong>Âú∞ÁÇπ:</strong> ${task.pickupLocation || '-'}
                        </div>
                        <div class="task-detail">
                            <strong>ÁîµËØù:</strong> ${task.customerPhone}
                        </div>
                        <div class="task-detail">
                            <strong>ÊäºÈáë:</strong> RM ${task.deposit.toFixed(2)}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-task btn-complete" onclick="completePickup(${task.id})">
                            <i class="fas fa-check"></i> ÂÆåÊàêÂèñÊú∫
                        </button>
                        <button class="btn-task btn-call" onclick="callCustomer('${task.customerPhone}')">
                            <i class="fas fa-phone"></i> ËÅîÁ≥ªÂÆ¢Êà∑
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderReturnTasks(tasks) {
            const container = document.getElementById('return-tasks');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">‰ªäÊó•Êó†ÂΩíËøò‰ªªÂä°</div>';
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-header">
                        <span class="task-time">${task.returnTime || '18:00'}</span>
                        <span class="task-status pending">ÂæÖÂΩíËøò</span>
                    </div>
                    <div class="task-details">
                        <div class="task-detail">
                            <strong>ËÆ¢ÂçïÂè∑:</strong> ${task.orderNumber}
                        </div>
                        <div class="task-detail">
                            <strong>ÂÆ¢Êà∑:</strong> ${task.customerName}
                        </div>
                        <div class="task-detail">
                            <strong>Áõ∏Êú∫:</strong> ${task.cameraModel || 'ÊâãÂä®ËÆ¢Âçï'}
                        </div>
                        <div class="task-detail">
                            <strong>Âú∞ÁÇπ:</strong> ${task.pickupLocation || '-'}
                        </div>
                        <div class="task-detail">
                            <strong>ÁîµËØù:</strong> ${task.customerPhone}
                        </div>
                        <div class="task-detail">
                            <strong>ÊäºÈáë:</strong> RM ${task.deposit.toFixed(2)}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-task btn-complete" onclick="completeReturn(${task.id})">
                            <i class="fas fa-check"></i> ÂÆåÊàêÂΩíËøò
                        </button>
                        <button class="btn-task btn-call" onclick="callCustomer('${task.customerPhone}')">
                            <i class="fas fa-phone"></i> ËÅîÁ≥ªÂÆ¢Êà∑
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function completePickup(orderId) {
            if (confirm('Á°ÆËÆ§ÂÆåÊàêÂèñÊú∫Ôºü')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'picked_up';
                    saveData();
                    loadDailyTasks();
                    loadOrders();
                    alert('ÂèñÊú∫ÂÆåÊàêÔºÅ');
                }
            }
        }

        function completeReturn(orderId) {
            if (confirm('Á°ÆËÆ§ÂÆåÊàêÂΩíËøòÔºü')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'returned';
                    saveData();
                    loadDailyTasks();
                    loadOrders();
                    alert('ÂΩíËøòÂÆåÊàêÔºÅ');
                }
            }
        }

        function callCustomer(phone) {
            if (confirm(`ÊòØÂê¶Ë¶ÅÊã®ÊâìÂÆ¢Êà∑ÁîµËØù: ${phone}Ôºü`)) {
                window.open(`tel:${phone}`);
            }
        }

        function renderUpcomingTasks(orders) {
            const container = document.getElementById('upcoming-tasks');
            const today = new Date();
            const upcomingDays = [];
            
            // ÁîüÊàêÊú™Êù•7Â§©ÁöÑÊó•Êúü
            for (let i = 1; i <= 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                upcomingDays.push(date.toISOString().split('T')[0]);
            }

            const upcomingData = upcomingDays.map(date => {
                const pickupCount = orders.filter(order => 
                    order.pickupDate === date && 
                    ['pending', 'confirmed'].includes(order.status)
                ).length;
                
                const returnCount = orders.filter(order => 
                    order.returnDate === date && 
                    ['confirmed', 'picked_up'].includes(order.status)
                ).length;

                return {
                    date: date,
                    pickupCount: pickupCount,
                    returnCount: returnCount,
                    totalCount: pickupCount + returnCount
                };
            }).filter(day => day.totalCount > 0);

            if (upcomingData.length === 0) {
                container.innerHTML = '<div class="no-tasks">Êú™Êù•7Â§©Êó†‰ªªÂä°</div>';
                return;
            }

            container.innerHTML = upcomingData.map(day => `
                <div class="upcoming-item">
                    <div>
                        <div class="upcoming-date">${formatDate(day.date)}</div>
                        <div style="font-size: 0.9em; color: #666;">
                            ÂèñÊú∫: ${day.pickupCount} | ÂΩíËøò: ${day.returnCount}
                        </div>
                    </div>
                    <div class="upcoming-count">${day.totalCount}</div>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            if (dateStr === today.toISOString().split('T')[0]) {
                return '‰ªäÂ§©';
            } else if (dateStr === tomorrow.toISOString().split('T')[0]) {
                return 'ÊòéÂ§©';
            } else {
                return date.toLocaleDateString('zh-CN', { 
                    month: 'short', 
                    day: 'numeric',
                    weekday: 'short'
                });
            }
        }

        // ËÆ¢ÂçïÁÆ°ÁêÜ
        function loadOrders() {
            const tbody = document.getElementById('orders-tbody');
            const table = document.getElementById('orders-table');
            const loading = document.getElementById('orders-loading');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">ÊöÇÊó†ËÆ¢Âçï</td></tr>';
            } else {
                tbody.innerHTML = orders.map(order => `
                    <tr>
                        <td>${order.orderNumber}</td>
                        <td>${order.customerName}</td>
                        <td>${order.cameraModel || 'ÊâãÂä®ËÆ¢Âçï'}</td>
                        <td>${order.pickupDate}</td>
                        <td>${order.returnDate}</td>
                        <td>${order.pickupLocation || '-'}</td>
                        <td>RM ${order.deposit.toFixed(2)}</td>
                        <td><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></td>
                        <td>
                            <button class="btn-task btn-complete" onclick="updateOrderStatus(${order.id}, 'confirmed')" ${order.status !== 'pending' ? 'disabled' : ''}>Á°ÆËÆ§</button>
                            <button class="btn-task btn-call" onclick="openEditOrder(${order.id})" style="background: #6c757d;">ÁºñËæë</button>
                            <button class="btn-task" onclick="updateOrderStatus(${order.id}, 'cancelled')" style="background: #dc3545;">ÂèñÊ∂à</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            loading.style.display = 'none';
            table.style.display = 'table';
        }

        function updateOrderStatus(orderId, status) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                if (status === 'cancelled') {
                    if (confirm('Á°ÆÂÆöË¶ÅÂèñÊ∂àËøô‰∏™ËÆ¢ÂçïÂêóÔºü')) {
                        order.status = status;
                        saveData();
                        loadOrders();
                        loadDailyTasks();
                        alert('ËÆ¢ÂçïÂ∑≤ÂèñÊ∂à');
                    }
                } else {
                    order.status = status;
                    saveData();
                    loadOrders();
                    loadDailyTasks();
                    alert('ËÆ¢ÂçïÁä∂ÊÄÅÂ∑≤Êõ¥Êñ∞');
                }
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'ÂæÖÁ°ÆËÆ§',
                'confirmed': 'Â∑≤Á°ÆËÆ§',
                'picked_up': 'Â∑≤ÂèñÊú∫',
                'returned': 'Â∑≤ÂΩíËøò',
                'cancelled': 'Â∑≤ÂèñÊ∂à'
            };
            return statusMap[status] || status;
        }

        function openEditOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                alert('ËÆ¢Âçï‰∏çÂ≠òÂú®');
                return;
            }

            // Â≠òÂÇ®ÂΩìÂâçÁºñËæëÁöÑËÆ¢ÂçïID
            window.editingOrderId = orderId;

            // Â°´ÂÖÖÁºñËæëË°®Âçï
            document.getElementById('edit-customer-name').value = order.customerName;
            document.getElementById('edit-customer-phone').value = order.customerPhone;
            document.getElementById('edit-pickup-date').value = order.pickupDate;
            document.getElementById('edit-return-date').value = order.returnDate;
            document.getElementById('edit-pickup-time').value = order.pickupTime || '10:00';
            document.getElementById('edit-return-time').value = order.returnTime || '18:00';
            document.getElementById('edit-daily-rate').value = order.dailyRate;
            document.getElementById('edit-deposit').value = order.deposit;
            
            // ËÆæÁΩÆÂú∞ÁÇπ
            if (order.pickupLocation) {
                if (order.pickupLocation.includes('ÂêâÈöÜÂù°')) {
                    document.getElementById('edit-pickup-location').value = 'KL';
                } else if (order.pickupLocation.includes('Êñ∞Â±±')) {
                    document.getElementById('edit-pickup-location').value = 'JB';
                } else if (order.pickupLocation.includes('Ëá™Âèñ')) {
                    document.getElementById('edit-pickup-location').value = 'custom';
                    document.getElementById('edit-custom-address').value = order.pickupLocation.replace('Ëá™Âèñ - ', '');
                    document.getElementById('edit-custom-address-group').style.display = 'block';
                }
            }

            // ËÆæÁΩÆÁõ∏Êú∫
            if (order.cameraId) {
                document.getElementById('edit-camera-select').value = order.cameraId;
                document.getElementById('edit-camera-model').value = order.cameraModel;
                document.getElementById('edit-camera-brand').value = order.cameraBrand;
            }

            // ËÆæÁΩÆ‰øùÈô©
            if (order.insuranceFee > 0) {
                document.getElementById('edit-insurance-checkbox').checked = true;
                document.getElementById('edit-insurance-fee').value = order.insuranceFee;
            }

            // ËÆ°ÁÆóÊÄª‰ª∑
            calculateEditTotal();

            // ÊòæÁ§∫ÁºñËæëÊ†áÁ≠æÈ°µ
            document.getElementById('edit-order-tab').style.display = 'block';
            
            // ÂàáÊç¢Âà∞ÁºñËæëÈ°µÈù¢
            showPage('edit-order');
        }

        function toggleEditCustomAddress() {
            const locationSelect = document.getElementById('edit-pickup-location');
            const customAddressGroup = document.getElementById('edit-custom-address-group');
            
            if (locationSelect.value === 'custom') {
                customAddressGroup.style.display = 'block';
            } else {
                customAddressGroup.style.display = 'none';
            }
        }

        function onEditCameraSelect() {
            const select = document.getElementById('edit-camera-select');
            const selectedCameraId = select.value;
            
            if (selectedCameraId) {
                const camera = cameras.find(c => c.id == selectedCameraId);
                if (camera) {
                    document.getElementById('edit-camera-model').value = camera.model;
                    document.getElementById('edit-camera-brand').value = camera.brand;
                    document.getElementById('edit-daily-rate').value = camera.dailyRate;
                    document.getElementById('edit-deposit').value = camera.deposit;
                    calculateEditTotal();
                }
            } else {
                // Ê∏ÖÁ©∫Â≠óÊÆµÔºåÂÖÅËÆ∏ÊâãÂä®ËæìÂÖ•
                document.getElementById('edit-camera-model').value = '';
                document.getElementById('edit-camera-brand').value = '';
                document.getElementById('edit-daily-rate').value = '';
                document.getElementById('edit-deposit').value = '';
                calculateEditTotal();
            }
        }

        function toggleEditInsurance() {
            const checkbox = document.getElementById('edit-insurance-checkbox');
            const insuranceInput = document.getElementById('edit-insurance-fee');
            const pickupDateStr = document.getElementById('edit-pickup-date').value;
            const returnDateStr = document.getElementById('edit-return-date').value;
            
            if (checkbox.checked && pickupDateStr && returnDateStr) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                insuranceInput.value = days * 5;
            } else {
                insuranceInput.value = 0;
            }
            // ÁßªÈô§ÈÄíÂΩíË∞ÉÁî®ÔºåÈÅøÂÖçÊó†ÈôêÂæ™ÁéØ
        }

        function calculateEditTotal() {
            const pickupDateStr = document.getElementById('edit-pickup-date').value;
            const returnDateStr = document.getElementById('edit-return-date').value;
            const dailyRate = parseFloat(document.getElementById('edit-daily-rate').value) || 0;
            const deposit = parseFloat(document.getElementById('edit-deposit').value) || 0;
            
            if (pickupDateStr && returnDateStr && dailyRate > 0) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                
                // Áõ¥Êé•ËÆ°ÁÆó‰øùÈô©ÈáëÔºåÈÅøÂÖçÈÄíÂΩíË∞ÉÁî®
                const checkbox = document.getElementById('edit-insurance-checkbox');
                const insuranceFee = checkbox.checked ? days * 5 : 0;
                document.getElementById('edit-insurance-fee').value = insuranceFee;
                
                const rentTotal = dailyRate * days;
                const totalAmount = rentTotal + deposit + insuranceFee;
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                document.getElementById('edit-rental-days').textContent = days;
                document.getElementById('edit-rent-total').textContent = `RM ${rentTotal.toFixed(2)}`;
                document.getElementById('edit-total-amount').textContent = `RM ${totalAmount.toFixed(2)}`;
                document.getElementById('edit-deposit-display').textContent = `RM ${deposit.toFixed(2)}`;
                document.getElementById('edit-insurance-fee-display').textContent = `RM ${insuranceFee.toFixed(2)}`;
            } else {
                // Ê∏ÖÁ©∫ÊòæÁ§∫
                document.getElementById('edit-rental-days').textContent = '0';
                document.getElementById('edit-rent-total').textContent = 'RM 0.00';
                document.getElementById('edit-total-amount').textContent = 'RM 0.00';
                document.getElementById('edit-deposit-display').textContent = 'RM 0.00';
                document.getElementById('edit-insurance-fee-display').textContent = 'RM 0.00';
            }
        }

        function saveOrderEdit() {
            if (!window.editingOrderId) {
                alert('Ê≤°ÊúâÊ≠£Âú®ÁºñËæëÁöÑËÆ¢Âçï');
                return;
            }

            const order = orders.find(o => o.id === window.editingOrderId);
            if (!order) {
                alert('ËÆ¢Âçï‰∏çÂ≠òÂú®');
                return;
            }

            // Ëé∑ÂèñË°®ÂçïÊï∞ÊçÆ
            const customerName = document.getElementById('edit-customer-name').value.trim();
            const customerPhone = document.getElementById('edit-customer-phone').value.trim();
            const pickupDate = document.getElementById('edit-pickup-date').value;
            const returnDate = document.getElementById('edit-return-date').value;
            const pickupLocation = document.getElementById('edit-pickup-location').value;
            const customAddress = document.getElementById('edit-custom-address').value.trim();
            const cameraId = document.getElementById('edit-camera-select').value;
            const cameraModel = document.getElementById('edit-camera-model').value.trim();
            const cameraBrand = document.getElementById('edit-camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('edit-daily-rate').value);
            const deposit = parseFloat(document.getElementById('edit-deposit').value);

            // È™åËØÅ
            if (!customerName || !customerPhone || !pickupDate || !returnDate || !dailyRate || !deposit) {
                alert('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ');
                return;
            }

            if (pickupLocation === 'custom' && !customAddress) {
                alert('ËØ∑Â°´ÂÜôËá™ÂèñÂú∞ÂùÄ');
                return;
            }

            const pickup = new Date(pickupDate);
            const returnD = new Date(returnDate);
            if (returnD <= pickup) {
                alert('ËøòÊú∫Êó•ÊúüÂøÖÈ°ªÊôö‰∫éÂèñÊú∫Êó•Êúü');
                return;
            }

            // Ê£ÄÊü•ÁßüÊúüÈáçÂè† - Âè™Ê£ÄÊü•Áõ∏ÂêåÁõ∏Êú∫ÁöÑÊúâÊïàËÆ¢Âçï
            const hasOverlap = orders.some(order => {
                // Âè™Ê£ÄÊü•Áõ∏ÂêåÁõ∏Êú∫ÁöÑËÆ¢Âçï
                if (order.cameraId !== cameraId) {
                    return false;
                }
                
                // Âè™Ê£ÄÊü•ÊúâÊïàËÆ¢ÂçïÔºàÊéíÈô§Â∑≤ÂèñÊ∂àÁöÑËÆ¢ÂçïÔºâ
                if (!['pending', 'confirmed', 'picked_up'].includes(order.status)) {
                    return false;
                }
                
                // ÊéíÈô§ÂΩìÂâçÁºñËæëÁöÑËÆ¢Âçï
                if (order.id === window.editingOrderId) {
                    return false;
                }
                
                const existingPickup = new Date(order.pickupDate);
                const existingReturn = new Date(order.returnDate);
                return (pickup <= existingReturn && returnD >= existingPickup);
            });

            if (hasOverlap) {
                alert('‚ùå ÁßüÊúüÂÜ≤Á™ÅÔºÅËØ∑ÈÄâÊã©ÂÖ∂‰ªñÊó•Êúü„ÄÇ');
                return;
            }

            // ÊûÑÂª∫Âú∞ÁÇπ‰ø°ÊÅØ
            let locationInfo = '';
            if (pickupLocation === 'KL') {
                locationInfo = 'ÂêâÈöÜÂù° (KL)';
            } else if (pickupLocation === 'JB') {
                locationInfo = 'Êñ∞Â±± (JB)';
            } else if (pickupLocation === 'custom') {
                locationInfo = `Ëá™Âèñ - ${customAddress}`;
            }

            // Êõ¥Êñ∞ËÆ¢Âçï
            order.customerName = customerName;
            order.customerPhone = customerPhone;
            order.cameraId = cameraId || null;
            order.cameraModel = cameraModel || 'ÊâãÂä®ËÆ¢Âçï';
            order.cameraBrand = cameraBrand || 'ÊâãÂä®ËÆ¢Âçï';
            order.pickupDate = pickupDate;
            order.returnDate = returnDate;
            order.pickupTime = document.getElementById('edit-pickup-time').value;
            order.returnTime = document.getElementById('edit-return-time').value;
            order.pickupLocation = locationInfo;
            order.dailyRate = dailyRate;
            order.deposit = deposit;
            order.insuranceFee = parseFloat(document.getElementById('edit-insurance-fee').value) || 0;

            saveData();
            alert('ËÆ¢Âçï‰øÆÊîπÊàêÂäüÔºÅ');
            document.getElementById('edit-order-tab').style.display = 'none';
            showPage('orders');
            loadOrders();
            loadDailyTasks();
        }

        function cancelOrderEdit() {
            window.editingOrderId = null;
            document.getElementById('edit-order-tab').style.display = 'none';
            showPage('orders');
        }

        function deleteOrder() {
            if (!window.editingOrderId) {
                alert('Ê≤°ÊúâÊ≠£Âú®ÁºñËæëÁöÑËÆ¢Âçï');
                return;
            }

            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËÆ¢ÂçïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                const orderIndex = orders.findIndex(o => o.id === window.editingOrderId);
                if (orderIndex !== -1) {
                    orders.splice(orderIndex, 1);
                    saveData();
                    alert('ËÆ¢ÂçïÂ∑≤Âà†Èô§');
                    document.getElementById('edit-order-tab').style.display = 'none';
                    showPage('orders');
                    loadOrders();
                    loadDailyTasks();
                }
            }
        }

        // Áõ∏Êú∫ÁÆ°ÁêÜ
        function loadCameras() {
            const container = document.getElementById('cameras-list');
            
            if (cameras.length === 0) {
                container.innerHTML = '<div class="no-tasks">ÊöÇÊó†Áõ∏Êú∫Êï∞ÊçÆ</div>';
                return;
            }

            container.innerHTML = cameras.map(camera => `
                <div class="task-item" style="border-left: 4px solid ${camera.color || '#3498db'};">
                    <div class="task-details">
                        <div class="task-detail">
                            <strong>ÂûãÂè∑:</strong> ${camera.brand} ${camera.model}
                        </div>
                        <div class="task-detail">
                            <strong>Êó•ÁßüÈáë:</strong> RM ${camera.dailyRate.toFixed(2)}
                        </div>
                        <div class="task-detail">
                            <strong>ÊäºÈáë:</strong> RM ${camera.deposit.toFixed(2)}
                        </div>
                        <div class="task-detail">
                            <strong>Áä∂ÊÄÅ:</strong> 
                            <select onchange="updateCameraStatus(${camera.id}, this.value)" style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; margin-left: 8px;">
                                <option value="available" ${camera.status === 'available' ? 'selected' : ''}>ÂèØÁî®</option>
                                <option value="booked" ${camera.status === 'booked' ? 'selected' : ''}>Â∑≤È¢ÑËÆ¢</option>
                                <option value="maintenance" ${camera.status === 'maintenance' ? 'selected' : ''}>Áª¥‰øÆ‰∏≠</option>
                                <option value="retired" ${camera.status === 'retired' ? 'selected' : ''}>Â∑≤ÈÄÄÂΩπ</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="btn-task" onclick="editCamera(${camera.id})">ÁºñËæë</button>
                        <button class="btn-task" onclick="deleteCamera(${camera.id})" style="background: #dc3545;">Âà†Èô§</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddCameraForm() {
            document.getElementById('add-camera-form').style.display = 'block';
        }

        function hideAddCameraForm() {
            document.getElementById('add-camera-form').style.display = 'none';
            document.getElementById('camera-model').value = '';
            document.getElementById('camera-brand').value = '';
            document.getElementById('camera-daily-rate').value = '';
            document.getElementById('camera-deposit').value = '';
            
            // ÊÅ¢Â§çÊ∑ªÂä†ÊåâÈíÆ
            const addButton = document.getElementById('add-camera-form').querySelector('button');
            if (addButton) {
                addButton.textContent = 'Ê∑ªÂä†Áõ∏Êú∫';
                addButton.onclick = addCamera;
            }
            
            // ÁßªÈô§ÂèñÊ∂àÊåâÈíÆ
            const cancelButton = document.getElementById('add-camera-form').querySelector('button[onclick="cancelCameraEdit()"]');
            if (cancelButton) {
                cancelButton.remove();
            }
        }

        function addCamera() {
            const model = document.getElementById('camera-model').value.trim();
            const brand = document.getElementById('camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('camera-daily-rate').value);
            const deposit = parseFloat(document.getElementById('camera-deposit').value);

            if (!model || !brand || !dailyRate || !deposit) {
                alert('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ');
                return;
            }

            // ÁîüÊàêÈöèÊú∫È¢úËâ≤
            const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22', '#34495e'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];

            const camera = {
                id: Date.now(),
                model: model,
                brand: brand,
                dailyRate: dailyRate,
                deposit: deposit,
                status: 'available',
                color: randomColor,
                createdAt: new Date().toISOString()
            };

            cameras.push(camera);
            saveData();
            loadCameras();
            loadCameraSelect();
            hideAddCameraForm();
            alert('Áõ∏Êú∫Ê∑ªÂä†ÊàêÂäüÔºÅ');
        }

        function updateCameraStatus(cameraId, newStatus) {
            const camera = cameras.find(c => c.id === cameraId);
            if (camera) {
                camera.status = newStatus;
                saveData();
                loadCameras();
                alert(`Áõ∏Êú∫Áä∂ÊÄÅÂ∑≤Êõ¥Êñ∞‰∏∫: ${getCameraStatusText(newStatus)}`);
            }
        }

        function getCameraStatusText(status) {
            const statusMap = {
                'available': 'ÂèØÁî®',
                'booked': 'Â∑≤È¢ÑËÆ¢',
                'maintenance': 'Áª¥‰øÆ‰∏≠',
                'retired': 'Â∑≤ÈÄÄÂΩπ'
            };
            return statusMap[status] || 'Êú™Áü•';
        }

        function editCamera(cameraId) {
            const camera = cameras.find(c => c.id === cameraId);
            if (!camera) {
                alert('Áõ∏Êú∫‰∏çÂ≠òÂú®');
                return;
            }

            // ÊòæÁ§∫ÁºñËæëË°®Âçï
            const form = document.getElementById('add-camera-form');
            form.style.display = 'block';
            
            // Â°´ÂÖÖÁé∞ÊúâÊï∞ÊçÆ
            document.getElementById('camera-model').value = camera.model;
            document.getElementById('camera-brand').value = camera.brand;
            document.getElementById('camera-daily-rate').value = camera.dailyRate;
            document.getElementById('camera-deposit').value = camera.deposit;
            
            // ‰øÆÊîπÊåâÈíÆÊñáÊú¨ÂíåÂäüËÉΩ
            const addButton = form.querySelector('button[onclick="addCamera()"]');
            addButton.textContent = '‰øùÂ≠ò‰øÆÊîπ';
            addButton.onclick = () => saveCameraEdit(cameraId);
            
            // Ê∑ªÂä†ÂèñÊ∂àÊåâÈíÆ
            if (!form.querySelector('button[onclick="cancelCameraEdit()"]')) {
                const cancelButton = document.createElement('button');
                cancelButton.type = 'button';
                cancelButton.className = 'btn';
                cancelButton.textContent = 'ÂèñÊ∂à';
                cancelButton.onclick = cancelCameraEdit;
                cancelButton.style.marginLeft = '10px';
                addButton.parentNode.appendChild(cancelButton);
            }
        }

        function saveCameraEdit(cameraId) {
            const model = document.getElementById('camera-model').value.trim();
            const brand = document.getElementById('camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('camera-daily-rate').value);
            const deposit = parseFloat(document.getElementById('camera-deposit').value);

            if (!model || !brand || !dailyRate || !deposit) {
                alert('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ');
                return;
            }

            const camera = cameras.find(c => c.id === cameraId);
            if (camera) {
                camera.model = model;
                camera.brand = brand;
                camera.dailyRate = dailyRate;
                camera.deposit = deposit;
                
                saveData();
                loadCameras();
                loadCameraSelect();
                hideAddCameraForm();
                alert('Áõ∏Êú∫‰ø°ÊÅØ‰øÆÊîπÊàêÂäüÔºÅ');
            }
        }

        function cancelCameraEdit() {
            hideAddCameraForm();
            
            // ÊÅ¢Â§çÊ∑ªÂä†ÊåâÈíÆ
            const addButton = document.getElementById('add-camera-form').querySelector('button[onclick="saveCameraEdit()"]');
            if (addButton) {
                addButton.textContent = 'Ê∑ªÂä†Áõ∏Êú∫';
                addButton.onclick = addCamera;
            }
            
            // ÁßªÈô§ÂèñÊ∂àÊåâÈíÆ
            const cancelButton = document.getElementById('add-camera-form').querySelector('button[onclick="cancelCameraEdit()"]');
            if (cancelButton) {
                cancelButton.remove();
            }
        }

        function deleteCamera(cameraId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Áõ∏Êú∫ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                const cameraIndex = cameras.findIndex(c => c.id === cameraId);
                if (cameraIndex !== -1) {
                    cameras.splice(cameraIndex, 1);
                    saveData();
                    loadCameras();
                    loadCameraSelect();
                    alert('Áõ∏Êú∫Â∑≤Âà†Èô§');
                }
            }
        }

        // È°µÈù¢ÂàáÊç¢
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(pageId + '-page').classList.add('active');
            
            // ÊâæÂà∞ÂØπÂ∫îÁöÑÊ†áÁ≠æÈ°µÊåâÈíÆÂπ∂ÊøÄÊ¥ª
            const targetTab = document.querySelector(`.nav-tab[onclick="showPage('${pageId}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            if (pageId === 'daily-tasks') {
                loadDailyTasks();
            } else if (pageId === 'orders') {
                loadOrders();
            } else if (pageId === 'cameras') {
                loadCameras();
            } else if (pageId === 'edit-order') {
                // Âä†ËΩΩÁõ∏Êú∫ÈÄâÊã©ÂàóË°®
                const select = document.getElementById('edit-camera-select');
                select.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Áõ∏Êú∫</option>';
                cameras.forEach(camera => {
                    const option = document.createElement('option');
                    option.value = camera.id;
                    option.textContent = `${camera.brand} ${camera.model} - RM${camera.dailyRate}/Â§©`;
                    select.appendChild(option);
                });
            }
        }

        // Êï∞ÊçÆÂ≠òÂÇ®
        function saveData() {
            localStorage.setItem('cameraRentalOrders', JSON.stringify(orders));
            localStorage.setItem('cameraRentalCameras', JSON.stringify(cameras));
            localStorage.setItem('cameraRentalOrderCounter', orderCounter.toString());
        }

        // ÁªëÂÆö‰∫ã‰ª∂
        document.getElementById('pickup-date').addEventListener('change', function() {
            console.log('ÂèñÊú∫Êó•ÊúüÂèòÂåñ:', this.value);
            calculateTotal();
        });
        document.getElementById('return-date').addEventListener('change', function() {
            console.log('ËøòÊú∫Êó•ÊúüÂèòÂåñ:', this.value);
            calculateTotal();
        });
        document.getElementById('daily-rate').addEventListener('input', function() {
            console.log('Êó•ÁßüÈáëÂèòÂåñ:', this.value);
            calculateTotal();
        });
        document.getElementById('deposit').addEventListener('input', function() {
            console.log('ÊäºÈáëÂèòÂåñ:', this.value);
            calculateTotal();
        });
        document.getElementById('insurance-checkbox').addEventListener('change', function() {
            console.log('‰øùÈô©Â§çÈÄâÊ°ÜÂèòÂåñ:', this.checked);
            calculateTotal();
        });

        // ÁªëÂÆöÁºñËæëË°®Âçï‰∫ã‰ª∂
        document.getElementById('edit-pickup-date').addEventListener('change', calculateEditTotal);
        document.getElementById('edit-return-date').addEventListener('change', calculateEditTotal);
        document.getElementById('edit-daily-rate').addEventListener('input', calculateEditTotal);
        document.getElementById('edit-deposit').addEventListener('input', calculateEditTotal);
        document.getElementById('edit-insurance-checkbox').addEventListener('change', calculateEditTotal);
    </script>
</body>
</html>
