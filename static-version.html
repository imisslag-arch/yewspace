<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“· ç›¸æœºç§Ÿèµç®¡ç†ç³»ç»Ÿ - ç§»åŠ¨ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: #2E64E5;
            border-radius: 8px;
            position: relative;
            animation: pulse 2s infinite;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            width: 20px;
            height: 20px;
            background: #2E64E5;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border: 3px solid white;
            border-radius: 50%;
            background: white;
        }

        .logo-icon .inner-circle {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #2E64E5;
            border-radius: 50%;
            border: 2px solid white;
        }

        .logo-icon .vertical-line {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 2px;
            height: 20px;
            background: white;
        }

        .logo-icon .text {
            position: absolute;
            top: 50%;
            left: 8px;
            transform: translateY(-50%);
            color: white;
            font-size: 8px;
            font-weight: bold;
            line-height: 1;
            text-align: center;
        }

        .logo-text h1 {
            margin: 0 0 5px 0;
            font-size: 2.2em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .logo-text p {
            margin: 0;
            font-size: 1em;
            opacity: 0.9;
            font-weight: 300;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .page {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: 70vh;
        }

        .page.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
        }

        .calendar-nav:hover {
            background: #5a6fd8;
        }

        .month-year {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: #666;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            position: relative;
        }

        .day:hover {
            background: #e3f2fd;
            transform: scale(1.05);
        }

        .day.selected {
            background: #667eea;
            color: white;
        }

        .day.today {
            background: #ffeb3b;
            color: #333;
        }

        .day.other-month {
            color: #ccc;
        }

        .day.has-order {
            background: #4caf50;
            color: white;
        }

        .day.has-order::after {
            content: 'â—';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .booking-lines {
            display: flex;
            flex-direction: column;
            gap: 1px;
            max-height: 20px;
            overflow: hidden;
        }

        .booking-line {
            width: 100%;
            height: 3px;
            border-radius: 1px;
            transition: opacity 0.2s;
        }

        .booking-line:hover {
            opacity: 0.8;
        }

        .rental-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .task-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-time {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .task-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .task-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .task-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .task-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
        }

        .task-detail {
            display: flex;
            flex-direction: column;
        }

        .task-detail strong {
            color: #495057;
            margin-bottom: 2px;
        }

        .task-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }

        .btn-task {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .btn-complete {
            background: #28a745;
            color: white;
        }

        .btn-complete:hover {
            background: #218838;
        }

        .btn-call {
            background: #17a2b8;
            color: white;
        }

        .btn-call:hover {
            background: #138496;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .orders-table th,
        .orders-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .orders-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #555;
        }

        .orders-table tr:hover {
            background: #f5f5f5;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d4edda; color: #155724; }
        .status-picked_up { background: #cce5ff; color: #004085; }
        .status-returned { background: #d1ecf1; color: #0c5460; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        .no-tasks {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .logo {
                flex-direction: column;
                gap: 10px;
            }
            
            .logo-icon {
                width: 50px;
                height: 50px;
            }
            
            .logo-icon .text {
                font-size: 7px;
            }
            
            .logo-text h1 {
                font-size: 1.8em;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-tab {
                width: 100%;
                max-width: 300px;
            }
            
            .rental-info {
                grid-template-columns: 1fr;
            }
            
            .summary-stats {
                grid-template-columns: 1fr;
            }
            
            .task-details {
                grid-template-columns: 1fr;
            }
            
            .orders-table {
                font-size: 0.8em;
            }
            
            .orders-table th,
            .orders-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <div class="text">YEW'S<br>SPACE</div>
                        <div class="vertical-line"></div>
                        <div class="inner-circle"></div>
                    </div>
                    <div class="logo-text">
                        <h1>YEW'S SPACE</h1>
                        <p>ä¸“ä¸šç›¸æœºç§Ÿèµç®¡ç†</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('booking')">é¢„è®¢ç³»ç»Ÿ</button>
            <button class="nav-tab" onclick="showPage('daily-tasks')">æ¯æ—¥ä»»åŠ¡</button>
            <button class="nav-tab" onclick="showPage('orders')">è®¢å•ç®¡ç†</button>
            <button class="nav-tab" onclick="showPage('cameras')">ç›¸æœºç®¡ç†</button>
            <button class="nav-tab" id="edit-order-tab" onclick="showPage('edit-order')" style="display: none;">ç¼–è¾‘è®¢å•</button>
        </div>

        <!-- é¢„è®¢é¡µé¢ -->
        <div id="booking-page" class="page active">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="previousMonth()">â€¹</button>
                    <div class="month-year" id="month-year"></div>
                    <button class="calendar-nav" onclick="nextMonth()">â€º</button>
                </div>
                <div class="weekdays">
                    <div class="weekday">å‘¨ä¸€</div>
                    <div class="weekday">å‘¨äºŒ</div>
                    <div class="weekday">å‘¨ä¸‰</div>
                    <div class="weekday">å‘¨å››</div>
                    <div class="weekday">å‘¨äº”</div>
                    <div class="weekday">å‘¨å…­</div>
                    <div class="weekday">å‘¨æ—¥</div>
                </div>
                <div class="days" id="calendar-days"></div>
            </div>

            <form id="booking-form">
                <div class="rental-info">
                    <div>
                        <h3>å®¢æˆ·ä¿¡æ¯</h3>
                        <div class="form-group">
                            <label>å®¢æˆ·å§“å</label>
                            <input type="text" id="customer-name" placeholder="è¾“å…¥å®¢æˆ·å§“å" required>
                        </div>
                        <div class="form-group">
                            <label>å®¢æˆ·ç”µè¯</label>
                            <input type="tel" id="customer-phone" placeholder="è¾“å…¥å®¢æˆ·ç”µè¯" required>
                        </div>
                        <div class="form-group">
                            <label>å–æœºåœ°ç‚¹</label>
                            <select id="pickup-location" onchange="toggleCustomAddress()">
                                <option value="KL">å‰éš†å¡ (KL)</option>
                                <option value="JB">æ–°å±± (JB)</option>
                                <option value="custom">è‡ªå– - è‡ªå®šä¹‰åœ°å€</option>
                            </select>
                        </div>
                        <div class="form-group" id="custom-address-group" style="display: none;">
                            <label>è‡ªå–åœ°å€</label>
                            <textarea id="custom-address" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€"></textarea>
                        </div>
                    </div>
                    
                    <div>
                        <h3>ç›¸æœºé€‰æ‹©</h3>
                        <div class="form-group">
                            <label>é€‰æ‹©ç›¸æœº</label>
                            <select id="camera-select" onchange="onCameraSelect()">
                                <option value="">è¯·é€‰æ‹©ç›¸æœº</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç›¸æœºå‹å·</label>
                            <input type="text" id="camera-model" placeholder="æ‰‹åŠ¨è¾“å…¥ç›¸æœºå‹å·" readonly>
                        </div>
                        <div class="form-group">
                            <label>å“ç‰Œ</label>
                            <input type="text" id="camera-brand" placeholder="æ‰‹åŠ¨è¾“å…¥å“ç‰Œ" readonly>
                        </div>
                    </div>
                    
                    <div>
                        <h3>ç§Ÿèµä¿¡æ¯</h3>
                        <div class="form-group">
                            <label>å–æœºæ—¥æœŸ</label>
                            <input type="date" id="pickup-date" required>
                        </div>
                        <div class="form-group">
                            <label>è¿˜æœºæ—¥æœŸ</label>
                            <input type="date" id="return-date" required>
                        </div>
                        <div class="form-group">
                            <label>å–æœºæ—¶é—´</label>
                            <input type="time" id="pickup-time" value="10:00">
                        </div>
                        <div class="form-group">
                            <label>è¿˜æœºæ—¶é—´</label>
                            <input type="time" id="return-time" value="18:00">
                        </div>
                        <div class="form-group">
                            <label>æ—¥ç§Ÿé‡‘ (RM)</label>
                            <input type="number" id="daily-rate" placeholder="è¾“å…¥æ—¥ç§Ÿé‡‘" required>
                        </div>
                        <div class="form-group">
                            <label>æŠ¼é‡‘ (RM)</label>
                            <input type="number" id="deposit" placeholder="è¾“å…¥æŠ¼é‡‘" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="insurance-checkbox" onchange="toggleInsurance()">
                                è´­ä¹°ä¿é™© (RM5/å¤©)
                            </label>
                            <input type="number" id="insurance-fee" value="0" readonly>
                        </div>
                    </div>
                </div>

                <!-- ä»·æ ¼è®¡ç®—æ˜¾ç¤º -->
                <div class="summary-card" style="margin-top: 20px;">
                    <h3>è´¹ç”¨è®¡ç®—</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="rental-days">0</span>
                            <span class="stat-label">ç§Ÿèµå¤©æ•°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="rent-total">RM 0.00</span>
                            <span class="stat-label">ç§Ÿé‡‘å°è®¡</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="total-amount">RM 0.00</span>
                            <span class="stat-label">æ€»è®¡é‡‘é¢</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                        <div>æŠ¼é‡‘: <span id="deposit-display">RM 0.00</span></div>
                        <div>ä¿é™©: <span id="insurance-fee-display">RM 0.00</span></div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button type="button" class="btn" onclick="forceCalculate()" style="width: auto; background: #28a745;">é‡æ–°è®¡ç®—</button>
                    </div>
                </div>

                <button type="button" class="btn" onclick="createOrder()">åˆ›å»ºè®¢å•</button>
            </form>
        </div>

        <!-- æ¯æ—¥ä»»åŠ¡é¡µé¢ -->
        <div id="daily-tasks-page" class="page">
            <div class="summary-card">
                <h3>ä»Šæ—¥æ¦‚è§ˆ</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="today-pickups">0</span>
                        <span class="stat-label">å–æœºä»»åŠ¡</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="today-returns">0</span>
                        <span class="stat-label">å½’è¿˜ä»»åŠ¡</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="today-total">0</span>
                        <span class="stat-label">æ€»ä»»åŠ¡æ•°</span>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                <div>
                    <h3><i class="fas fa-arrow-up" style="color: #28a745;"></i> ä»Šæ—¥å–æœºä»»åŠ¡</h3>
                    <div id="pickup-tasks" class="task-list">
                        <div class="no-tasks">ä»Šæ—¥æ— å–æœºä»»åŠ¡</div>
                    </div>
                </div>

                <div>
                    <h3><i class="fas fa-arrow-down" style="color: #ffc107;"></i> ä»Šæ—¥å½’è¿˜ä»»åŠ¡</h3>
                    <div id="return-tasks" class="task-list">
                        <div class="no-tasks">ä»Šæ—¥æ— å½’è¿˜ä»»åŠ¡</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3><i class="fas fa-calendar-week" style="color: #007bff;"></i> æœªæ¥7å¤©ä»»åŠ¡é¢„è§ˆ</h3>
                <div id="upcoming-tasks" class="upcoming-list">
                    <div class="no-tasks">æœªæ¥7å¤©æ— ä»»åŠ¡</div>
                </div>
            </div>
        </div>

        <!-- è®¢å•ç®¡ç†é¡µé¢ -->
        <div id="orders-page" class="page">
            <h2>æ‰€æœ‰è®¢å•</h2>
            <div id="orders-loading" class="loading">åŠ è½½ä¸­...</div>
            <table class="orders-table" id="orders-table" style="display: none;">
                <thead>
                    <tr>
                        <th>è®¢å•å·</th>
                        <th>å®¢æˆ·å§“å</th>
                        <th>ç›¸æœºå‹å·</th>
                        <th>å–æœºæ—¥æœŸ</th>
                        <th>è¿˜æœºæ—¥æœŸ</th>
                        <th>åœ°ç‚¹</th>
                        <th>æŠ¼é‡‘</th>
                        <th>çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="orders-tbody">
                </tbody>
            </table>
        </div>

        <!-- è®¢å•ç¼–è¾‘é¡µé¢ -->
        <div id="edit-order-page" class="page">
            <div class="page-header">
                <h2>ç¼–è¾‘è®¢å•</h2>
                <button class="btn" onclick="showPage('orders')" style="width: auto; background: #6c757d;">è¿”å›è®¢å•ç®¡ç†</button>
            </div>
            
            <form id="edit-order-form">
                <div class="rental-info">
                    <div>
                        <h3>å®¢æˆ·ä¿¡æ¯</h3>
                        <div class="form-group">
                            <label>å®¢æˆ·å§“å</label>
                            <input type="text" id="edit-customer-name" placeholder="è¾“å…¥å®¢æˆ·å§“å" required>
                        </div>
                        <div class="form-group">
                            <label>å®¢æˆ·ç”µè¯</label>
                            <input type="tel" id="edit-customer-phone" placeholder="è¾“å…¥å®¢æˆ·ç”µè¯" required>
                        </div>
                        <div class="form-group">
                            <label>å–æœºåœ°ç‚¹</label>
                            <select id="edit-pickup-location" onchange="toggleEditCustomAddress()">
                                <option value="KL">å‰éš†å¡ (KL)</option>
                                <option value="JB">æ–°å±± (JB)</option>
                                <option value="custom">è‡ªå– - è‡ªå®šä¹‰åœ°å€</option>
                            </select>
                        </div>
                        <div class="form-group" id="edit-custom-address-group" style="display: none;">
                            <label>è‡ªå–åœ°å€</label>
                            <textarea id="edit-custom-address" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€"></textarea>
                        </div>
                    </div>
                    
                    <div>
                        <h3>ç›¸æœºé€‰æ‹©</h3>
                        <div class="form-group">
                            <label>é€‰æ‹©ç›¸æœº</label>
                            <select id="edit-camera-select" onchange="onEditCameraSelect()">
                                <option value="">è¯·é€‰æ‹©ç›¸æœº</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç›¸æœºå‹å·</label>
                            <input type="text" id="edit-camera-model" placeholder="æ‰‹åŠ¨è¾“å…¥ç›¸æœºå‹å·">
                        </div>
                        <div class="form-group">
                            <label>å“ç‰Œ</label>
                            <input type="text" id="edit-camera-brand" placeholder="æ‰‹åŠ¨è¾“å…¥å“ç‰Œ">
                        </div>
                    </div>
                    
                    <div>
                        <h3>ç§Ÿèµä¿¡æ¯</h3>
                        <div class="form-group">
                            <label>å–æœºæ—¥æœŸ</label>
                            <input type="date" id="edit-pickup-date" required>
                        </div>
                        <div class="form-group">
                            <label>è¿˜æœºæ—¥æœŸ</label>
                            <input type="date" id="edit-return-date" required>
                        </div>
                        <div class="form-group">
                            <label>å–æœºæ—¶é—´</label>
                            <input type="time" id="edit-pickup-time" value="10:00">
                        </div>
                        <div class="form-group">
                            <label>è¿˜æœºæ—¶é—´</label>
                            <input type="time" id="edit-return-time" value="18:00">
                        </div>
                        <div class="form-group">
                            <label>æ—¥ç§Ÿé‡‘ (RM)</label>
                            <input type="number" id="edit-daily-rate" placeholder="è¾“å…¥æ—¥ç§Ÿé‡‘" required>
                        </div>
                        <div class="form-group">
                            <label>æŠ¼é‡‘ (RM)</label>
                            <input type="number" id="edit-deposit" placeholder="è¾“å…¥æŠ¼é‡‘" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="edit-insurance-checkbox" onchange="toggleEditInsurance()">
                                è´­ä¹°ä¿é™© (RM5/å¤©)
                            </label>
                            <input type="number" id="edit-insurance-fee" value="0" readonly>
                        </div>
                    </div>
                </div>

                <!-- ä»·æ ¼è®¡ç®—æ˜¾ç¤º -->
                <div class="summary-card" style="margin-top: 20px;">
                    <h3>è´¹ç”¨è®¡ç®—</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="edit-rental-days">0</span>
                            <span class="stat-label">ç§Ÿèµå¤©æ•°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="edit-rent-total">RM 0.00</span>
                            <span class="stat-label">ç§Ÿé‡‘å°è®¡</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="edit-total-amount">RM 0.00</span>
                            <span class="stat-label">æ€»è®¡é‡‘é¢</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                        <div>æŠ¼é‡‘: <span id="edit-deposit-display">RM 0.00</span></div>
                        <div>ä¿é™©: <span id="edit-insurance-fee-display">RM 0.00</span></div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="saveOrderEdit()" style="flex: 1;">ä¿å­˜ä¿®æ”¹</button>
                    <button type="button" class="btn" onclick="cancelOrderEdit()" style="flex: 1; background: #6c757d;">å–æ¶ˆ</button>
                    <button type="button" class="btn" onclick="deleteOrder()" style="flex: 1; background: #dc3545;">åˆ é™¤è®¢å•</button>
                </div>
            </form>
        </div>

        <!-- ç›¸æœºç®¡ç†é¡µé¢ -->
        <div id="cameras-page" class="page">
            <h2>ç›¸æœºç®¡ç†</h2>
            <button class="btn" onclick="showAddCameraForm()" style="width: auto; margin-bottom: 20px;">æ·»åŠ ç›¸æœº</button>
            
            <div id="add-camera-form" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3>æ·»åŠ æ–°ç›¸æœº</h3>
                <div class="form-group">
                    <label>ç›¸æœºå‹å·</label>
                    <input type="text" id="camera-model" placeholder="è¾“å…¥ç›¸æœºå‹å·">
                </div>
                <div class="form-group">
                    <label>å“ç‰Œ</label>
                    <input type="text" id="camera-brand" placeholder="è¾“å…¥å“ç‰Œ">
                </div>
                <div class="form-group">
                    <label>æ—¥ç§Ÿé‡‘ (RM)</label>
                    <input type="number" id="camera-daily-rate" placeholder="è¾“å…¥æ—¥ç§Ÿé‡‘">
                </div>
                <div class="form-group">
                    <label>æŠ¼é‡‘ (RM)</label>
                    <input type="number" id="camera-deposit" placeholder="è¾“å…¥æŠ¼é‡‘">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="addCamera()" style="width: auto;">æ·»åŠ </button>
                    <button class="btn" onclick="hideAddCameraForm()" style="width: auto; background: #6c757d;">å–æ¶ˆ</button>
                </div>
            </div>

            <div id="cameras-list">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentDate = new Date();
        let orders = JSON.parse(localStorage.getItem('cameraRentalOrders') || '[]');
        let cameras = JSON.parse(localStorage.getItem('cameraRentalCameras') || '[]');
        let orderCounter = parseInt(localStorage.getItem('cameraRentalOrderCounter') || '1000');

        // å¦‚æœæ²¡æœ‰ç›¸æœºæ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤ç›¸æœº
        if (cameras.length === 0) {
            cameras = [
                { id: 1, brand: 'DJI', model: 'Air 2S', dailyRate: 80, deposit: 300, status: 'available', color: '#3498db' },
                { id: 2, brand: 'DJI', model: 'Mini 3 Pro', dailyRate: 60, deposit: 250, status: 'available', color: '#e74c3c' },
                { id: 3, brand: 'DJI', model: 'Mavic 3', dailyRate: 100, deposit: 400, status: 'available', color: '#2ecc71' },
                { id: 4, brand: 'Canon', model: 'EOS R5', dailyRate: 150, deposit: 500, status: 'maintenance', color: '#f39c12' },
                { id: 5, brand: 'Sony', model: 'A7R IV', dailyRate: 120, deposit: 400, status: 'available', color: '#9b59b6' }
            ];
            saveData();
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
            loadDailyTasks();
            loadOrders();
            loadCameras();
            loadCameraSelect();
            setupDefaultDates();
            
            // åˆå§‹åŒ–è®¡ç®—
            setTimeout(() => {
                calculateTotal();
            }, 500);
        });

        // æ—¥å†åŠŸèƒ½
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];
            
            document.getElementById('month-year').textContent = `${year}å¹´ ${monthNames[month]}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayOfWeek = (firstDay.getDay() + 6) % 7; // å‘¨ä¸€ä¸º0
            
            const daysContainer = document.getElementById('calendar-days');
            daysContainer.innerHTML = '';
            
            // ä¸Šä¸ªæœˆçš„æ—¥æœŸ
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = new Date(year, month, -i);
                const dayElement = createDayElement(day, true);
                daysContainer.appendChild(dayElement);
            }
            
            // å½“å‰æœˆçš„æ—¥æœŸ
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                const dayElement = createDayElement(date, false);
                daysContainer.appendChild(dayElement);
            }
            
            // ä¸‹ä¸ªæœˆçš„æ—¥æœŸ
            const remainingDays = 42 - (firstDayOfWeek + lastDay.getDate());
            for (let day = 1; day <= remainingDays; day++) {
                const date = new Date(year, month + 1, day);
                const dayElement = createDayElement(date, true);
                daysContainer.appendChild(dayElement);
            }
        }

        function createDayElement(date, isOtherMonth) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day';
            dayElement.textContent = date.getDate();
            
            if (isOtherMonth) {
                dayElement.classList.add('other-month');
            }
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('today');
            }
            
            // æ£€æŸ¥è¯¥æ—¥æœŸçš„ç›¸æœºé¢„è®¢æƒ…å†µ
            const dateStr = date.toISOString().split('T')[0];
            const dayBookings = getDayBookings(dateStr);
            
            if (dayBookings.length > 0) {
                // åˆ›å»ºç›¸æœºæ¡£æœŸçº¿æ¡æ˜¾ç¤º
                const bookingLines = dayBookings.map(booking => 
                    `<div class="booking-line" style="background: ${booking.color}; height: 3px; margin: 1px 0; border-radius: 1px;" title="${booking.cameraName}"></div>`
                ).join('');
                
                dayElement.innerHTML = `
                    <div class="day-number">${date.getDate()}</div>
                    <div class="booking-lines">${bookingLines}</div>
                `;
            }
            
            dayElement.onclick = () => selectDate(date);
            
            return dayElement;
        }

        function getDayBookings(dateStr) {
            const bookings = [];
            
            orders.forEach(order => {
                if (!['pending', 'confirmed', 'picked_up'].includes(order.status)) {
                    return; // è·³è¿‡å·²å–æ¶ˆçš„è®¢å•
                }
                
                const pickupDate = new Date(order.pickupDate + 'T00:00:00');
                const returnDate = new Date(order.returnDate + 'T00:00:00');
                const checkDate = new Date(dateStr + 'T00:00:00');
                
                // æ£€æŸ¥æ—¥æœŸæ˜¯å¦åœ¨ç§ŸæœŸå†…
                if (checkDate >= pickupDate && checkDate <= returnDate) {
                    const camera = cameras.find(c => c.id == order.cameraId);
                    if (camera) {
                        bookings.push({
                            cameraName: `${camera.brand} ${camera.model}`,
                            color: camera.color || '#3498db',
                            orderId: order.id
                        });
                    }
                }
            });
            
            return bookings;
        }

        function selectDate(date) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.day.selected').forEach(day => {
                day.classList.remove('selected');
            });
            
            // é€‰æ‹©å½“å‰æ—¥æœŸ
            event.target.classList.add('selected');
            
            // è‡ªåŠ¨å¡«å……æ—¥æœŸ
            const dateStr = date.toISOString().split('T')[0];
            document.getElementById('pickup-date').value = dateStr;
            
            // è‡ªåŠ¨è®¾ç½®è¿˜æœºæ—¥æœŸä¸º3å¤©å
            const returnDate = new Date(date);
            returnDate.setDate(date.getDate() + 3);
            document.getElementById('return-date').value = returnDate.toISOString().split('T')[0];
            
            // é‡æ–°æ¸²æŸ“æ—¥å†ä»¥æ˜¾ç¤ºé«˜äº®
            renderCalendar();
            // é‡æ–°é€‰æ‹©å½“å‰æ—¥æœŸ
            setTimeout(() => {
                const selectedDay = Array.from(document.querySelectorAll('.day')).find(day => 
                    day.textContent == date.getDate() && !day.classList.contains('other-month')
                );
                if (selectedDay) {
                    selectedDay.classList.add('selected');
                }
            }, 0);
            
            calculateTotal();
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        // è¡¨å•åŠŸèƒ½
        function setupDefaultDates() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            document.getElementById('pickup-date').value = today.toISOString().split('T')[0];
            document.getElementById('return-date').value = tomorrow.toISOString().split('T')[0];
            
            // è®¾ç½®é»˜è®¤æ—¶é—´
            document.getElementById('pickup-time').value = '10:00';
            document.getElementById('return-time').value = '18:00';
        }

        function toggleCustomAddress() {
            const locationSelect = document.getElementById('pickup-location');
            const customAddressGroup = document.getElementById('custom-address-group');
            
            if (locationSelect.value === 'custom') {
                customAddressGroup.style.display = 'block';
            } else {
                customAddressGroup.style.display = 'none';
            }
        }

        function toggleInsurance() {
            const checkbox = document.getElementById('insurance-checkbox');
            const insuranceInput = document.getElementById('insurance-fee');
            const pickupDateStr = document.getElementById('pickup-date').value;
            const returnDateStr = document.getElementById('return-date').value;
            
            if (checkbox.checked && pickupDateStr && returnDateStr) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                insuranceInput.value = days * 5;
            } else {
                insuranceInput.value = 0;
            }
        }

        // æ·»åŠ  calculateInsurance å‡½æ•°
        function calculateInsurance() {
            const checkbox = document.getElementById('insurance-checkbox');
            const insuranceInput = document.getElementById('insurance-fee');
            const pickupDateStr = document.getElementById('pickup-date').value;
            const returnDateStr = document.getElementById('return-date').value;
            
            if (checkbox.checked && pickupDateStr && returnDateStr) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                insuranceInput.value = days * 5;
            } else {
                insuranceInput.value = 0;
            }
        }

        function calculateTotal() {
            const pickupDateStr = document.getElementById('pickup-date').value;
            const returnDateStr = document.getElementById('return-date').value;
            const dailyRate = parseFloat(document.getElementById('daily-rate').value) || 0;
            const deposit = parseFloat(document.getElementById('deposit').value) || 0;
            
            console.log('è®¡ç®—æ€»ä»·:', { pickupDateStr, returnDateStr, dailyRate, deposit });
            
            if (pickupDateStr && returnDateStr && dailyRate > 0) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                
                // æ›´æ–°ä¿é™©é‡‘è®¡ç®—
                calculateInsurance();
                const insuranceFee = parseFloat(document.getElementById('insurance-fee').value) || 0;
                
                const rentTotal = dailyRate * days;
                const totalAmount = rentTotal + deposit + insuranceFee;
                
                console.log('è®¡ç®—ç»“æœ:', { days, rentTotal, deposit, insuranceFee, totalAmount });
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('rental-days').textContent = days;
                document.getElementById('rent-total').textContent = `RM ${rentTotal.toFixed(2)}`;
                document.getElementById('total-amount').textContent = `RM ${totalAmount.toFixed(2)}`;
                document.getElementById('deposit-display').textContent = `RM ${deposit.toFixed(2)}`;
                document.getElementById('insurance-fee-display').textContent = `RM ${insuranceFee.toFixed(2)}`;
            } else {
                // æ¸…ç©ºæ˜¾ç¤º
                document.getElementById('rental-days').textContent = '0';
                document.getElementById('rent-total').textContent = 'RM 0.00';
                document.getElementById('total-amount').textContent = 'RM 0.00';
                document.getElementById('deposit-display').textContent = 'RM 0.00';
                document.getElementById('insurance-fee-display').textContent = 'RM 0.00';
            }
        }

        // å¼ºåˆ¶è®¡ç®—å‡½æ•°
        function forceCalculate() {
            console.log('å¼ºåˆ¶è®¡ç®—æ€»ä»·');
            calculateTotal();
        }

        // ç›¸æœºé€‰æ‹©åŠŸèƒ½
        function loadCameraSelect() {
            const select = document.getElementById('camera-select');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©ç›¸æœº</option>';
            
            cameras.forEach(camera => {
                const option = document.createElement('option');
                option.value = camera.id;
                option.textContent = `${camera.brand} ${camera.model} - RM${camera.dailyRate}/å¤©`;
                select.appendChild(option);
            });
        }

        function onCameraSelect() {
            const select = document.getElementById('camera-select');
            const selectedCameraId = select.value;
            
            console.log('é€‰æ‹©ç›¸æœº:', selectedCameraId);
            
            if (selectedCameraId) {
                const camera = cameras.find(c => c.id == selectedCameraId);
                if (camera) {
                    console.log('æ‰¾åˆ°ç›¸æœº:', camera);
                    document.getElementById('camera-model').value = camera.model;
                    document.getElementById('camera-brand').value = camera.brand;
                    document.getElementById('daily-rate').value = camera.dailyRate;
                    document.getElementById('deposit').value = camera.deposit;
                    
                    // å¼ºåˆ¶è®¡ç®—
                    setTimeout(() => {
                        calculateTotal();
                    }, 100);
                }
            } else {
                // æ¸…ç©ºå­—æ®µï¼Œå…è®¸æ‰‹åŠ¨è¾“å…¥
                document.getElementById('camera-model').value = '';
                document.getElementById('camera-brand').value = '';
                document.getElementById('daily-rate').value = '';
                document.getElementById('deposit').value = '';
                
                // å¼ºåˆ¶è®¡ç®—
                setTimeout(() => {
                    calculateTotal();
                }, 100);
            }
        }

        // è®¢å•ç®¡ç†
        function createOrder() {
            const customerName = document.getElementById('customer-name').value.trim();
            const customerPhone = document.getElementById('customer-phone').value.trim();
            const pickupDate = document.getElementById('pickup-date').value;
            const returnDate = document.getElementById('return-date').value;
            const pickupLocation = document.getElementById('pickup-location').value;
            const customAddress = document.getElementById('custom-address').value.trim();
            const cameraId = document.getElementById('camera-select').value;
            const cameraModel = document.getElementById('camera-model').value.trim();
            const cameraBrand = document.getElementById('camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('daily-rate').value);
            const deposit = parseFloat(document.getElementById('deposit').value);
            
            // éªŒè¯
            if (!customerName || !customerPhone || !pickupDate || !returnDate || !dailyRate || !deposit) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            if (pickupLocation === 'custom' && !customAddress) {
                alert('è¯·å¡«å†™è‡ªå–åœ°å€');
                return;
            }
            
            const pickup = new Date(pickupDate);
            const returnD = new Date(returnDate);
            if (returnD <= pickup) {
                alert('è¿˜æœºæ—¥æœŸå¿…é¡»æ™šäºå–æœºæ—¥æœŸ');
                return;
            }

            // æ£€æŸ¥ç§ŸæœŸé‡å  - åªæ£€æŸ¥ç›¸åŒç›¸æœºçš„æœ‰æ•ˆè®¢å•
            const hasOverlap = orders.some(order => {
                // åªæ£€æŸ¥ç›¸åŒç›¸æœºçš„è®¢å•
                if (order.cameraId !== cameraId) {
                    return false;
                }
                
                // åªæ£€æŸ¥æœ‰æ•ˆè®¢å•ï¼ˆæ’é™¤å·²å–æ¶ˆçš„è®¢å•ï¼‰
                if (!['pending', 'confirmed', 'picked_up'].includes(order.status)) {
                    return false;
                }
                
                // æ’é™¤å½“å‰ç¼–è¾‘çš„è®¢å•
                if (window.editingOrderId && order.id === window.editingOrderId) {
                    return false;
                }
                
                const existingPickup = new Date(order.pickupDate);
                const existingReturn = new Date(order.returnDate);
                return (pickup <= existingReturn && returnD >= existingPickup);
            });

            if (hasOverlap) {
                alert('âŒ ç§ŸæœŸå†²çªï¼è¯·é€‰æ‹©å…¶ä»–æ—¥æœŸã€‚');
                return;
            }

            // æ„å»ºåœ°ç‚¹ä¿¡æ¯
            let locationInfo = '';
            if (pickupLocation === 'KL') {
                locationInfo = 'å‰éš†å¡ (KL)';
            } else if (pickupLocation === 'JB') {
                locationInfo = 'æ–°å±± (JB)';
            } else if (pickupLocation === 'custom') {
                locationInfo = `è‡ªå– - ${customAddress}`;
            }

            // åˆ›å»ºè®¢å•
            const order = {
                id: orderCounter++,
                orderNumber: `CR${orderCounter.toString().padStart(4, '0')}`,
                customerName: customerName,
                customerPhone: customerPhone,
                cameraId: cameraId || null,
                cameraModel: cameraModel || 'æ‰‹åŠ¨è®¢å•',
                cameraBrand: cameraBrand || 'æ‰‹åŠ¨è®¢å•',
                pickupDate: pickupDate,
                returnDate: returnDate,
                pickupTime: document.getElementById('pickup-time').value,
                returnTime: document.getElementById('return-time').value,
                pickupLocation: locationInfo,
                dailyRate: dailyRate,
                deposit: deposit,
                insuranceFee: parseFloat(document.getElementById('insurance-fee').value) || 0,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            if (window.editingOrderId) {
                // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°ç°æœ‰è®¢å•
                const orderIndex = orders.findIndex(o => o.id === window.editingOrderId);
                if (orderIndex !== -1) {
                    orders[orderIndex] = order;
                    alert(`è®¢å•ä¿®æ”¹æˆåŠŸï¼\nè®¢å•å·: ${order.orderNumber}`);
                }
                window.editingOrderId = null;
            } else {
                // æ–°å»ºæ¨¡å¼ï¼šæ·»åŠ æ–°è®¢å•
                orders.push(order);
                alert(`è®¢å•åˆ›å»ºæˆåŠŸï¼\nè®¢å•å·: ${order.orderNumber}`);
            }
            
            saveData();
            resetForm();
            loadDailyTasks();
            loadOrders();
        }

        function resetForm() {
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('pickup-location').value = 'KL';
            document.getElementById('custom-address').value = '';
            document.getElementById('custom-address-group').style.display = 'none';
            document.getElementById('camera-select').value = '';
            document.getElementById('camera-model').value = '';
            document.getElementById('camera-brand').value = '';
            document.getElementById('daily-rate').value = '';
            document.getElementById('deposit').value = '';
            document.getElementById('insurance-checkbox').checked = false;
            document.getElementById('insurance-fee').value = '0';
            setupDefaultDates();
            calculateTotal();
            
            // æ¸…é™¤ç¼–è¾‘æ¨¡å¼
            window.editingOrderId = null;
        }

        // æ¯æ—¥ä»»åŠ¡
        function loadDailyTasks() {
            const today = new Date().toISOString().split('T')[0];
            
            const pickupTasks = orders.filter(order => 
                order.pickupDate === today && ['pending', 'confirmed'].includes(order.status)
            );

            const returnTasks = orders.filter(order => 
                order.returnDate === today && ['confirmed', 'picked_up'].includes(order.status)
            );

            document.getElementById('today-pickups').textContent = pickupTasks.length;
            document.getElementById('today-returns').textContent = returnTasks.length;
            document.getElementById('today-total').textContent = pickupTasks.length + returnTasks.length;

            renderPickupTasks(pickupTasks);
            renderReturnTasks(returnTasks);
            renderUpcomingTasks(orders);
        }

        function renderPickupTasks(tasks) {
            const container = document.getElementById('pickup-tasks');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">ä»Šæ—¥æ— å–æœºä»»åŠ¡</div>';
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-header">
                        <span class="task-time">${task.pickupTime || '10:00'}</span>
                        <span class="task-status pending">å¾…å–æœº</span>
                    </div>
                    <div class="task-details">
                        <div class="task-detail">
                            <strong>è®¢å•å·:</strong> ${task.orderNumber}
                        </div>
                        <div class="task-detail">
                            <strong>å®¢æˆ·:</strong> ${task.customerName}
                        </div>
                        <div class="task-detail">
                            <strong>ç›¸æœº:</strong> ${task.cameraModel || 'æ‰‹åŠ¨è®¢å•'}
                        </div>
                        <div class="task-detail">
                            <strong>åœ°ç‚¹:</strong> ${task.pickupLocation || '-'}
                        </div>
                        <div class="task-detail">
                            <strong>ç”µè¯:</strong> ${task.customerPhone}
                        </div>
                        <div class="task-detail">
                            <strong>æŠ¼é‡‘:</strong> RM ${task.deposit.toFixed(2)}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-task btn-complete" onclick="completePickup(${task.id})">
                            <i class="fas fa-check"></i> å®Œæˆå–æœº
                        </button>
                        <button class="btn-task btn-call" onclick="callCustomer('${task.customerPhone}')">
                            <i class="fas fa-phone"></i> è”ç³»å®¢æˆ·
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderReturnTasks(tasks) {
            const container = document.getElementById('return-tasks');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">ä»Šæ—¥æ— å½’è¿˜ä»»åŠ¡</div>';
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-header">
                        <span class="task-time">${task.returnTime || '18:00'}</span>
                        <span class="task-status pending">å¾…å½’è¿˜</span>
                    </div>
                    <div class="task-details">
                        <div class="task-detail">
                            <strong>è®¢å•å·:</strong> ${task.orderNumber}
                        </div>
                        <div class="task-detail">
                            <strong>å®¢æˆ·:</strong> ${task.customerName}
                        </div>
                        <div class="task-detail">
                            <strong>ç›¸æœº:</strong> ${task.cameraModel || 'æ‰‹åŠ¨è®¢å•'}
                        </div>
                        <div class="task-detail">
                            <strong>åœ°ç‚¹:</strong> ${task.pickupLocation || '-'}
                        </div>
                        <div class="task-detail">
                            <strong>ç”µè¯:</strong> ${task.customerPhone}
                        </div>
                        <div class="task-detail">
                            <strong>æŠ¼é‡‘:</strong> RM ${task.deposit.toFixed(2)}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-task btn-complete" onclick="completeReturn(${task.id})">
                            <i class="fas fa-check"></i> å®Œæˆå½’è¿˜
                        </button>
                        <button class="btn-task btn-call" onclick="callCustomer('${task.customerPhone}')">
                            <i class="fas fa-phone"></i> è”ç³»å®¢æˆ·
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function completePickup(orderId) {
            if (confirm('ç¡®è®¤å®Œæˆå–æœºï¼Ÿ')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'picked_up';
                    saveData();
                    loadDailyTasks();
                    loadOrders();
                    alert('å–æœºå®Œæˆï¼');
                }
            }
        }

        function completeReturn(orderId) {
            if (confirm('ç¡®è®¤å®Œæˆå½’è¿˜ï¼Ÿ')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'returned';
                    saveData();
                    loadDailyTasks();
                    loadOrders();
                    alert('å½’è¿˜å®Œæˆï¼');
                }
            }
        }

        function callCustomer(phone) {
            if (confirm(`æ˜¯å¦è¦æ‹¨æ‰“å®¢æˆ·ç”µè¯: ${phone}ï¼Ÿ`)) {
                window.open(`tel:${phone}`);
            }
        }

        function renderUpcomingTasks(orders) {
            const container = document.getElementById('upcoming-tasks');
            const today = new Date();
            const upcomingDays = [];
            
            // ç”Ÿæˆæœªæ¥7å¤©çš„æ—¥æœŸ
            for (let i = 1; i <= 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                upcomingDays.push(date.toISOString().split('T')[0]);
            }

            const upcomingData = upcomingDays.map(date => {
                const pickupCount = orders.filter(order => 
                    order.pickupDate === date && 
                    ['pending', 'confirmed'].includes(order.status)
                ).length;
                
                const returnCount = orders.filter(order => 
                    order.returnDate === date && 
                    ['confirmed', 'picked_up'].includes(order.status)
                ).length;

                return {
                    date: date,
                    pickupCount: pickupCount,
                    returnCount: returnCount,
                    totalCount: pickupCount + returnCount
                };
            }).filter(day => day.totalCount > 0);

            if (upcomingData.length === 0) {
                container.innerHTML = '<div class="no-tasks">æœªæ¥7å¤©æ— ä»»åŠ¡</div>';
                return;
            }

            container.innerHTML = upcomingData.map(day => `
                <div class="upcoming-item">
                    <div>
                        <div class="upcoming-date">${formatDate(day.date)}</div>
                        <div style="font-size: 0.9em; color: #666;">
                            å–æœº: ${day.pickupCount} | å½’è¿˜: ${day.returnCount}
                        </div>
                    </div>
                    <div class="upcoming-count">${day.totalCount}</div>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            if (dateStr === today.toISOString().split('T')[0]) {
                return 'ä»Šå¤©';
            } else if (dateStr === tomorrow.toISOString().split('T')[0]) {
                return 'æ˜å¤©';
            } else {
                return date.toLocaleDateString('zh-CN', { 
                    month: 'short', 
                    day: 'numeric',
                    weekday: 'short'
                });
            }
        }

        // è®¢å•ç®¡ç†
        function loadOrders() {
            const tbody = document.getElementById('orders-tbody');
            const table = document.getElementById('orders-table');
            const loading = document.getElementById('orders-loading');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">æš‚æ— è®¢å•</td></tr>';
            } else {
                tbody.innerHTML = orders.map(order => `
                    <tr>
                        <td>${order.orderNumber}</td>
                        <td>${order.customerName}</td>
                        <td>${order.cameraModel || 'æ‰‹åŠ¨è®¢å•'}</td>
                        <td>${order.pickupDate}</td>
                        <td>${order.returnDate}</td>
                        <td>${order.pickupLocation || '-'}</td>
                        <td>RM ${order.deposit.toFixed(2)}</td>
                        <td><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></td>
                        <td>
                            <button class="btn-task btn-complete" onclick="updateOrderStatus(${order.id}, 'confirmed')" ${order.status !== 'pending' ? 'disabled' : ''}>ç¡®è®¤</button>
                            <button class="btn-task btn-call" onclick="openEditOrder(${order.id})" style="background: #6c757d;">ç¼–è¾‘</button>
                            <button class="btn-task" onclick="updateOrderStatus(${order.id}, 'cancelled')" style="background: #dc3545;">å–æ¶ˆ</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            loading.style.display = 'none';
            table.style.display = 'table';
        }

        function updateOrderStatus(orderId, status) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                if (status === 'cancelled') {
                    if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                        order.status = status;
                        saveData();
                        loadOrders();
                        loadDailyTasks();
                        alert('è®¢å•å·²å–æ¶ˆ');
                    }
                } else {
                    order.status = status;
                    saveData();
                    loadOrders();
                    loadDailyTasks();
                    alert('è®¢å•çŠ¶æ€å·²æ›´æ–°');
                }
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'å¾…ç¡®è®¤',
                'confirmed': 'å·²ç¡®è®¤',
                'picked_up': 'å·²å–æœº',
                'returned': 'å·²å½’è¿˜',
                'cancelled': 'å·²å–æ¶ˆ'
            };
            return statusMap[status] || status;
        }

        function openEditOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                alert('è®¢å•ä¸å­˜åœ¨');
                return;
            }

            // å­˜å‚¨å½“å‰ç¼–è¾‘çš„è®¢å•ID
            window.editingOrderId = orderId;

            // å¡«å……ç¼–è¾‘è¡¨å•
            document.getElementById('edit-customer-name').value = order.customerName;
            document.getElementById('edit-customer-phone').value = order.customerPhone;
            document.getElementById('edit-pickup-date').value = order.pickupDate;
            document.getElementById('edit-return-date').value = order.returnDate;
            document.getElementById('edit-pickup-time').value = order.pickupTime || '10:00';
            document.getElementById('edit-return-time').value = order.returnTime || '18:00';
            document.getElementById('edit-daily-rate').value = order.dailyRate;
            document.getElementById('edit-deposit').value = order.deposit;
            
            // è®¾ç½®åœ°ç‚¹
            if (order.pickupLocation) {
                if (order.pickupLocation.includes('å‰éš†å¡')) {
                    document.getElementById('edit-pickup-location').value = 'KL';
                } else if (order.pickupLocation.includes('æ–°å±±')) {
                    document.getElementById('edit-pickup-location').value = 'JB';
                } else if (order.pickupLocation.includes('è‡ªå–')) {
                    document.getElementById('edit-pickup-location').value = 'custom';
                    document.getElementById('edit-custom-address').value = order.pickupLocation.replace('è‡ªå– - ', '');
                    document.getElementById('edit-custom-address-group').style.display = 'block';
                }
            }

            // è®¾ç½®ç›¸æœº
            if (order.cameraId) {
                document.getElementById('edit-camera-select').value = order.cameraId;
                document.getElementById('edit-camera-model').value = order.cameraModel;
                document.getElementById('edit-camera-brand').value = order.cameraBrand;
            }

            // è®¾ç½®ä¿é™©
            if (order.insuranceFee > 0) {
                document.getElementById('edit-insurance-checkbox').checked = true;
                document.getElementById('edit-insurance-fee').value = order.insuranceFee;
            }

            // è®¡ç®—æ€»ä»·
            calculateEditTotal();

            // æ˜¾ç¤ºç¼–è¾‘æ ‡ç­¾é¡µ
            document.getElementById('edit-order-tab').style.display = 'block';
            
            // åˆ‡æ¢åˆ°ç¼–è¾‘é¡µé¢
            showPage('edit-order');
        }

        function toggleEditCustomAddress() {
            const locationSelect = document.getElementById('edit-pickup-location');
            const customAddressGroup = document.getElementById('edit-custom-address-group');
            
            if (locationSelect.value === 'custom') {
                customAddressGroup.style.display = 'block';
            } else {
                customAddressGroup.style.display = 'none';
            }
        }

        function onEditCameraSelect() {
            const select = document.getElementById('edit-camera-select');
            const selectedCameraId = select.value;
            
            if (selectedCameraId) {
                const camera = cameras.find(c => c.id == selectedCameraId);
                if (camera) {
                    document.getElementById('edit-camera-model').value = camera.model;
                    document.getElementById('edit-camera-brand').value = camera.brand;
                    document.getElementById('edit-daily-rate').value = camera.dailyRate;
                    document.getElementById('edit-deposit').value = camera.deposit;
                    calculateEditTotal();
                }
            } else {
                // æ¸…ç©ºå­—æ®µï¼Œå…è®¸æ‰‹åŠ¨è¾“å…¥
                document.getElementById('edit-camera-model').value = '';
                document.getElementById('edit-camera-brand').value = '';
                document.getElementById('edit-daily-rate').value = '';
                document.getElementById('edit-deposit').value = '';
                calculateEditTotal();
            }
        }

        function toggleEditInsurance() {
            const checkbox = document.getElementById('edit-insurance-checkbox');
            const insuranceInput = document.getElementById('edit-insurance-fee');
            const pickupDateStr = document.getElementById('edit-pickup-date').value;
            const returnDateStr = document.getElementById('edit-return-date').value;
            
            if (checkbox.checked && pickupDateStr && returnDateStr) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                insuranceInput.value = days * 5;
            } else {
                insuranceInput.value = 0;
            }
            // ç§»é™¤é€’å½’è°ƒç”¨ï¼Œé¿å…æ— é™å¾ªç¯
        }

        function calculateEditTotal() {
            const pickupDateStr = document.getElementById('edit-pickup-date').value;
            const returnDateStr = document.getElementById('edit-return-date').value;
            const dailyRate = parseFloat(document.getElementById('edit-daily-rate').value) || 0;
            const deposit = parseFloat(document.getElementById('edit-deposit').value) || 0;
            
            if (pickupDateStr && returnDateStr && dailyRate > 0) {
                const pickupDate = new Date(pickupDateStr + 'T00:00:00');
                const returnDate = new Date(returnDateStr + 'T00:00:00');
                const days = Math.max(1, Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)));
                
                // ç›´æ¥è®¡ç®—ä¿é™©é‡‘ï¼Œé¿å…é€’å½’è°ƒç”¨
                const checkbox = document.getElementById('edit-insurance-checkbox');
                const insuranceFee = checkbox.checked ? days * 5 : 0;
                document.getElementById('edit-insurance-fee').value = insuranceFee;
                
                const rentTotal = dailyRate * days;
                const totalAmount = rentTotal + deposit + insuranceFee;
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('edit-rental-days').textContent = days;
                document.getElementById('edit-rent-total').textContent = `RM ${rentTotal.toFixed(2)}`;
                document.getElementById('edit-total-amount').textContent = `RM ${totalAmount.toFixed(2)}`;
                document.getElementById('edit-deposit-display').textContent = `RM ${deposit.toFixed(2)}`;
                document.getElementById('edit-insurance-fee-display').textContent = `RM ${insuranceFee.toFixed(2)}`;
            } else {
                // æ¸…ç©ºæ˜¾ç¤º
                document.getElementById('edit-rental-days').textContent = '0';
                document.getElementById('edit-rent-total').textContent = 'RM 0.00';
                document.getElementById('edit-total-amount').textContent = 'RM 0.00';
                document.getElementById('edit-deposit-display').textContent = 'RM 0.00';
                document.getElementById('edit-insurance-fee-display').textContent = 'RM 0.00';
            }
        }

        function saveOrderEdit() {
            if (!window.editingOrderId) {
                alert('æ²¡æœ‰æ­£åœ¨ç¼–è¾‘çš„è®¢å•');
                return;
            }

            const order = orders.find(o => o.id === window.editingOrderId);
            if (!order) {
                alert('è®¢å•ä¸å­˜åœ¨');
                return;
            }

            // è·å–è¡¨å•æ•°æ®
            const customerName = document.getElementById('edit-customer-name').value.trim();
            const customerPhone = document.getElementById('edit-customer-phone').value.trim();
            const pickupDate = document.getElementById('edit-pickup-date').value;
            const returnDate = document.getElementById('edit-return-date').value;
            const pickupLocation = document.getElementById('edit-pickup-location').value;
            const customAddress = document.getElementById('edit-custom-address').value.trim();
            const cameraId = document.getElementById('edit-camera-select').value;
            const cameraModel = document.getElementById('edit-camera-model').value.trim();
            const cameraBrand = document.getElementById('edit-camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('edit-daily-rate').value);
            const deposit = parseFloat(document.getElementById('edit-deposit').value);

            // éªŒè¯
            if (!customerName || !customerPhone || !pickupDate || !returnDate || !dailyRate || !deposit) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            if (pickupLocation === 'custom' && !customAddress) {
                alert('è¯·å¡«å†™è‡ªå–åœ°å€');
                return;
            }

            const pickup = new Date(pickupDate);
            const returnD = new Date(returnDate);
            if (returnD <= pickup) {
                alert('è¿˜æœºæ—¥æœŸå¿…é¡»æ™šäºå–æœºæ—¥æœŸ');
                return;
            }

            // æ£€æŸ¥ç§ŸæœŸé‡å  - åªæ£€æŸ¥ç›¸åŒç›¸æœºçš„æœ‰æ•ˆè®¢å•
            const hasOverlap = orders.some(order => {
                // åªæ£€æŸ¥ç›¸åŒç›¸æœºçš„è®¢å•
                if (order.cameraId !== cameraId) {
                    return false;
                }
                
                // åªæ£€æŸ¥æœ‰æ•ˆè®¢å•ï¼ˆæ’é™¤å·²å–æ¶ˆçš„è®¢å•ï¼‰
                if (!['pending', 'confirmed', 'picked_up'].includes(order.status)) {
                    return false;
                }
                
                // æ’é™¤å½“å‰ç¼–è¾‘çš„è®¢å•
                if (order.id === window.editingOrderId) {
                    return false;
                }
                
                const existingPickup = new Date(order.pickupDate);
                const existingReturn = new Date(order.returnDate);
                return (pickup <= existingReturn && returnD >= existingPickup);
            });

            if (hasOverlap) {
                alert('âŒ ç§ŸæœŸå†²çªï¼è¯·é€‰æ‹©å…¶ä»–æ—¥æœŸã€‚');
                return;
            }

            // æ„å»ºåœ°ç‚¹ä¿¡æ¯
            let locationInfo = '';
            if (pickupLocation === 'KL') {
                locationInfo = 'å‰éš†å¡ (KL)';
            } else if (pickupLocation === 'JB') {
                locationInfo = 'æ–°å±± (JB)';
            } else if (pickupLocation === 'custom') {
                locationInfo = `è‡ªå– - ${customAddress}`;
            }

            // æ›´æ–°è®¢å•
            order.customerName = customerName;
            order.customerPhone = customerPhone;
            order.cameraId = cameraId || null;
            order.cameraModel = cameraModel || 'æ‰‹åŠ¨è®¢å•';
            order.cameraBrand = cameraBrand || 'æ‰‹åŠ¨è®¢å•';
            order.pickupDate = pickupDate;
            order.returnDate = returnDate;
            order.pickupTime = document.getElementById('edit-pickup-time').value;
            order.returnTime = document.getElementById('edit-return-time').value;
            order.pickupLocation = locationInfo;
            order.dailyRate = dailyRate;
            order.deposit = deposit;
            order.insuranceFee = parseFloat(document.getElementById('edit-insurance-fee').value) || 0;

            saveData();
            alert('è®¢å•ä¿®æ”¹æˆåŠŸï¼');
            document.getElementById('edit-order-tab').style.display = 'none';
            showPage('orders');
            loadOrders();
            loadDailyTasks();
        }

        function cancelOrderEdit() {
            window.editingOrderId = null;
            document.getElementById('edit-order-tab').style.display = 'none';
            showPage('orders');
        }

        function deleteOrder() {
            if (!window.editingOrderId) {
                alert('æ²¡æœ‰æ­£åœ¨ç¼–è¾‘çš„è®¢å•');
                return;
            }

            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                const orderIndex = orders.findIndex(o => o.id === window.editingOrderId);
                if (orderIndex !== -1) {
                    orders.splice(orderIndex, 1);
                    saveData();
                    alert('è®¢å•å·²åˆ é™¤');
                    document.getElementById('edit-order-tab').style.display = 'none';
                    showPage('orders');
                    loadOrders();
                    loadDailyTasks();
                }
            }
        }

        // ç›¸æœºç®¡ç†
        function loadCameras() {
            const container = document.getElementById('cameras-list');
            
            if (cameras.length === 0) {
                container.innerHTML = '<div class="no-tasks">æš‚æ— ç›¸æœºæ•°æ®</div>';
                return;
            }

            container.innerHTML = cameras.map(camera => `
                <div class="task-item" style="border-left: 4px solid ${camera.color || '#3498db'};">
                    <div class="task-details">
                        <div class="task-detail">
                            <strong>å‹å·:</strong> ${camera.brand} ${camera.model}
                        </div>
                        <div class="task-detail">
                            <strong>æ—¥ç§Ÿé‡‘:</strong> RM ${camera.dailyRate.toFixed(2)}
                        </div>
                        <div class="task-detail">
                            <strong>æŠ¼é‡‘:</strong> RM ${camera.deposit.toFixed(2)}
                        </div>
                        <div class="task-detail">
                            <strong>çŠ¶æ€:</strong> 
                            <select onchange="updateCameraStatus(${camera.id}, this.value)" style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; margin-left: 8px;">
                                <option value="available" ${camera.status === 'available' ? 'selected' : ''}>å¯ç”¨</option>
                                <option value="booked" ${camera.status === 'booked' ? 'selected' : ''}>å·²é¢„è®¢</option>
                                <option value="maintenance" ${camera.status === 'maintenance' ? 'selected' : ''}>ç»´ä¿®ä¸­</option>
                                <option value="retired" ${camera.status === 'retired' ? 'selected' : ''}>å·²é€€å½¹</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="btn-task" onclick="editCamera(${camera.id})">ç¼–è¾‘</button>
                        <button class="btn-task" onclick="deleteCamera(${camera.id})" style="background: #dc3545;">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddCameraForm() {
            document.getElementById('add-camera-form').style.display = 'block';
        }

        function hideAddCameraForm() {
            document.getElementById('add-camera-form').style.display = 'none';
            document.getElementById('camera-model').value = '';
            document.getElementById('camera-brand').value = '';
            document.getElementById('camera-daily-rate').value = '';
            document.getElementById('camera-deposit').value = '';
            
            // æ¢å¤æ·»åŠ æŒ‰é’®
            const addButton = document.getElementById('add-camera-form').querySelector('button');
            if (addButton) {
                addButton.textContent = 'æ·»åŠ ç›¸æœº';
                addButton.onclick = addCamera;
            }
            
            // ç§»é™¤å–æ¶ˆæŒ‰é’®
            const cancelButton = document.getElementById('add-camera-form').querySelector('button[onclick="cancelCameraEdit()"]');
            if (cancelButton) {
                cancelButton.remove();
            }
        }

        function addCamera() {
            const model = document.getElementById('camera-model').value.trim();
            const brand = document.getElementById('camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('camera-daily-rate').value);
            const deposit = parseFloat(document.getElementById('camera-deposit').value);

            if (!model || !brand || !dailyRate || !deposit) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            // ç”Ÿæˆéšæœºé¢œè‰²
            const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22', '#34495e'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];

            const camera = {
                id: Date.now(),
                model: model,
                brand: brand,
                dailyRate: dailyRate,
                deposit: deposit,
                status: 'available',
                color: randomColor,
                createdAt: new Date().toISOString()
            };

            cameras.push(camera);
            saveData();
            loadCameras();
            loadCameraSelect();
            hideAddCameraForm();
            alert('ç›¸æœºæ·»åŠ æˆåŠŸï¼');
        }

        function updateCameraStatus(cameraId, newStatus) {
            const camera = cameras.find(c => c.id === cameraId);
            if (camera) {
                camera.status = newStatus;
                saveData();
                loadCameras();
                alert(`ç›¸æœºçŠ¶æ€å·²æ›´æ–°ä¸º: ${getCameraStatusText(newStatus)}`);
            }
        }

        function getCameraStatusText(status) {
            const statusMap = {
                'available': 'å¯ç”¨',
                'booked': 'å·²é¢„è®¢',
                'maintenance': 'ç»´ä¿®ä¸­',
                'retired': 'å·²é€€å½¹'
            };
            return statusMap[status] || 'æœªçŸ¥';
        }

        function editCamera(cameraId) {
            const camera = cameras.find(c => c.id === cameraId);
            if (!camera) {
                alert('ç›¸æœºä¸å­˜åœ¨');
                return;
            }

            // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
            const form = document.getElementById('add-camera-form');
            form.style.display = 'block';
            
            // å¡«å……ç°æœ‰æ•°æ®
            document.getElementById('camera-model').value = camera.model;
            document.getElementById('camera-brand').value = camera.brand;
            document.getElementById('camera-daily-rate').value = camera.dailyRate;
            document.getElementById('camera-deposit').value = camera.deposit;
            
            // ä¿®æ”¹æŒ‰é’®æ–‡æœ¬å’ŒåŠŸèƒ½
            const addButton = form.querySelector('button[onclick="addCamera()"]');
            addButton.textContent = 'ä¿å­˜ä¿®æ”¹';
            addButton.onclick = () => saveCameraEdit(cameraId);
            
            // æ·»åŠ å–æ¶ˆæŒ‰é’®
            if (!form.querySelector('button[onclick="cancelCameraEdit()"]')) {
                const cancelButton = document.createElement('button');
                cancelButton.type = 'button';
                cancelButton.className = 'btn';
                cancelButton.textContent = 'å–æ¶ˆ';
                cancelButton.onclick = cancelCameraEdit;
                cancelButton.style.marginLeft = '10px';
                addButton.parentNode.appendChild(cancelButton);
            }
        }

        function saveCameraEdit(cameraId) {
            const model = document.getElementById('camera-model').value.trim();
            const brand = document.getElementById('camera-brand').value.trim();
            const dailyRate = parseFloat(document.getElementById('camera-daily-rate').value);
            const deposit = parseFloat(document.getElementById('camera-deposit').value);

            if (!model || !brand || !dailyRate || !deposit) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            const camera = cameras.find(c => c.id === cameraId);
            if (camera) {
                camera.model = model;
                camera.brand = brand;
                camera.dailyRate = dailyRate;
                camera.deposit = deposit;
                
                saveData();
                loadCameras();
                loadCameraSelect();
                hideAddCameraForm();
                alert('ç›¸æœºä¿¡æ¯ä¿®æ”¹æˆåŠŸï¼');
            }
        }

        function cancelCameraEdit() {
            hideAddCameraForm();
            
            // æ¢å¤æ·»åŠ æŒ‰é’®
            const addButton = document.getElementById('add-camera-form').querySelector('button[onclick="saveCameraEdit()"]');
            if (addButton) {
                addButton.textContent = 'æ·»åŠ ç›¸æœº';
                addButton.onclick = addCamera;
            }
            
            // ç§»é™¤å–æ¶ˆæŒ‰é’®
            const cancelButton = document.getElementById('add-camera-form').querySelector('button[onclick="cancelCameraEdit()"]');
            if (cancelButton) {
                cancelButton.remove();
            }
        }

        function deleteCamera(cameraId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç›¸æœºå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                const cameraIndex = cameras.findIndex(c => c.id === cameraId);
                if (cameraIndex !== -1) {
                    cameras.splice(cameraIndex, 1);
                    saveData();
                    loadCameras();
                    loadCameraSelect();
                    alert('ç›¸æœºå·²åˆ é™¤');
                }
            }
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(pageId + '-page').classList.add('active');
            
            // æ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾é¡µæŒ‰é’®å¹¶æ¿€æ´»
            const targetTab = document.querySelector(`.nav-tab[onclick="showPage('${pageId}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            if (pageId === 'daily-tasks') {
                loadDailyTasks();
            } else if (pageId === 'orders') {
                loadOrders();
            } else if (pageId === 'cameras') {
                loadCameras();
            } else if (pageId === 'edit-order') {
                // åŠ è½½ç›¸æœºé€‰æ‹©åˆ—è¡¨
                const select = document.getElementById('edit-camera-select');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©ç›¸æœº</option>';
                cameras.forEach(camera => {
                    const option = document.createElement('option');
                    option.value = camera.id;
                    option.textContent = `${camera.brand} ${camera.model} - RM${camera.dailyRate}/å¤©`;
                    select.appendChild(option);
                });
            }
        }

        // æ•°æ®å­˜å‚¨
        function saveData() {
            localStorage.setItem('cameraRentalOrders', JSON.stringify(orders));
            localStorage.setItem('cameraRentalCameras', JSON.stringify(cameras));
            localStorage.setItem('cameraRentalOrderCounter', orderCounter.toString());
        }

        // ç»‘å®šäº‹ä»¶
        document.getElementById('pickup-date').addEventListener('change', function() {
            console.log('å–æœºæ—¥æœŸå˜åŒ–:', this.value);
            calculateTotal();
        });
        document.getElementById('return-date').addEventListener('change', function() {
            console.log('è¿˜æœºæ—¥æœŸå˜åŒ–:', this.value);
            calculateTotal();
        });
        document.getElementById('daily-rate').addEventListener('input', function() {
            console.log('æ—¥ç§Ÿé‡‘å˜åŒ–:', this.value);
            calculateTotal();
        });
        document.getElementById('deposit').addEventListener('input', function() {
            console.log('æŠ¼é‡‘å˜åŒ–:', this.value);
            calculateTotal();
        });
        document.getElementById('insurance-checkbox').addEventListener('change', function() {
            console.log('ä¿é™©å¤é€‰æ¡†å˜åŒ–:', this.checked);
            calculateTotal();
        });

        // ç»‘å®šç¼–è¾‘è¡¨å•äº‹ä»¶
        document.getElementById('edit-pickup-date').addEventListener('change', calculateEditTotal);
        document.getElementById('edit-return-date').addEventListener('change', calculateEditTotal);
        document.getElementById('edit-daily-rate').addEventListener('input', calculateEditTotal);
        document.getElementById('edit-deposit').addEventListener('input', calculateEditTotal);
        document.getElementById('edit-insurance-checkbox').addEventListener('change', calculateEditTotal);
    </script>
</body>
</html>
